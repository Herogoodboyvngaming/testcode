<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhÃ¡o Hoa Äáº¹p NhÆ° NgoÃ i Äá»i</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="canvas"></canvas>

    <!-- NÃºt báº­t/táº¯t Ã¢m thanh -->
    <div id="sound-btn" class="control-btn">ğŸ”Š</div>

    <!-- HÆ°á»›ng dáº«n tap láº§n Ä‘áº§u (áº©n sau khi unlock) -->
    <div id="hint">Tap mÃ n hÃ¬nh Ä‘á»ƒ báº­t Ã¢m thanh ná»•!</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        let particles = [];
        let fireworks = [];
        let soundEnabled = true;
        let hasInteracted = false;

        // Ã‚m thanh ná»• thá»±c táº¿ (royalty-free tá»« Mixkit)
        const explosionUrls = [
            'https://assets.mixkit.co/sfx/preview/mixkit-large-firework-explosion-1670.mp3',
            'https://assets.mixkit.co/sfx/preview/mixkit-firework-explosion-1669.mp3',
            'https://assets.mixkit.co/sfx/preview/mixkit-single-firework-explosion-1675.mp3'
        ];
        const explosionAudios = explosionUrls.map(url => {
            const a = new Audio(url);
            a.preload = 'auto';
            return a;
        });

        // Sound im láº·ng Ä‘á»ƒ force unlock audio context
        const silent = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=');

        function forceUnlock() {
            silent.play().catch(() => {});
            explosionAudios.forEach(a => a.play().catch(() => {}));
        }

        function playExplosion() {
            if (!soundEnabled || !hasInteracted) return;
            const a = explosionAudios[Math.floor(Math.random() * explosionAudios.length)].cloneNode();
            a.volume = 1.0;
            a.play().catch(() => {});
        }

        class Particle {
            constructor(x, y, vx, vy, color, size, life, trail = false) {
                this.x = x; this.y = y;
                this.vx = vx; this.vy = vy;
                this.color = color;
                this.size = size;
                this.life = life;
                this.maxLife = life;
                this.trail = trail;
                this.trailPoints = [];
            }

            update() {
                if (this.trail) {
                    this.trailPoints.push({x: this.x, y: this.y});
                    if (this.trailPoints.length > 30) this.trailPoints.shift();
                }

                this.vx *= 0.98;
                this.vy *= 0.98;
                this.vy += 0.12;
                this.x += this.vx;
                this.y += this.vy;
                this.life--;
            }

            draw() {
                if (this.life <= 0) return;
                const opacity = this.life / this.maxLife;

                // Trail dÃ i nhÆ° ngoÃ i Ä‘á»i
                if (this.trail && this.trailPoints.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trailPoints[0].x, this.trailPoints[0].y);
                    for (let i = 1; i < this.trailPoints.length; i++) {
                        ctx.lineTo(this.trailPoints[i].x, this.trailPoints[i].y);
                    }
                    ctx.strokeStyle = `\( {this.color} \){Math.floor(opacity * 255).toString(16).padStart(2, '0')}`;
                    ctx.lineWidth = this.size * 1.8;
                    ctx.stroke();
                }

                // Äáº§u háº¡t sÃ¡ng
                ctx.globalAlpha = opacity;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        class Firework {
            constructor(targetX = null, targetY = null) {
                this.x = targetX || Math.random() * canvas.width;
                this.y = canvas.height;
                this.targetX = targetX || this.x;
                this.targetY = targetY || Math.random() * (canvas.height * 0.35) + 60;
                this.vx = (this.targetX - this.x) / 70;
                this.vy = -22 - Math.random() * 8; // Bay lÃªn nhanh máº¡nh
                this.trailPoints = [];
            }

            update() {
                this.trailPoints.push({x: this.x, y: this.y});
                if (this.trailPoints.length > 35) this.trailPoints.shift();

                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.16;

                if (this.y <= this.targetY) {
                    this.explode();
                    return false;
                }
                return true;
            }

            draw() {
                // Trail launch dÃ i tráº¯ng
                if (this.trailPoints.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trailPoints[0].x, this.trailPoints[0].y);
                    for (let i = 1; i < this.trailPoints.length; i++) {
                        ctx.lineTo(this.trailPoints[i].x, this.trailPoints[i].y);
                    }
                    ctx.strokeStyle = 'rgba(255,255,255,0.9)';
                    ctx.lineWidth = 4;
                    ctx.stroke();
                }

                // Äáº§u rocket sÃ¡ng
                ctx.fillStyle = '#ffffaa';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            explode() {
                const count = 80 + Math.floor(Math.random() * 80);
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 3 + Math.random() * 9;
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed;
                    const hue = Math.random() * 360;
                    const color = `hsl(${hue}, 100%, 65%)`;
                    const size = 1.8 + Math.random() * 2.5;
                    const life = 70 + Math.random() * 70;
                    particles.push(new Particle(this.x, this.y, vx, vy, color, size, life, true));
                }
                playExplosion();
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(0,0,0,0.12)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            particles.forEach((p, i) => {
                p.update();
                if (p.life <= 0) particles.splice(i, 1);
                else p.draw();
            });

            fireworks = fireworks.filter(f => {
                f.draw();
                return f.update();
            });

            requestAnimationFrame(animate);
        }

        animate();

        // Tá»± Ä‘á»™ng báº¯n phÃ¡o liÃªn tá»¥c
        setInterval(() => {
            fireworks.push(new Firework());
        }, 1200);

        // Tap Ä‘á»ƒ báº¯n thÃªm + unlock sound
        function handleInteraction() {
            if (!hasInteracted) {
                hasInteracted = true;
                document.getElementById('hint').style.display = 'none';
                forceUnlock();
            }
        }

        canvas.addEventListener('click', (e) => {
            handleInteraction();
            fireworks.push(new Firework(e.clientX, e.clientY * 0.6));
        });
        canvas.addEventListener('touchstart', (e) => {
            handleInteraction();
            e.preventDefault();
            const t = e.touches[0];
            fireworks.push(new Firework(t.clientX, t.clientY * 0.6));
        });

        // NÃºt báº­t/táº¯t Ã¢m thanh
        const soundBtn = document.getElementById('sound-btn');
        soundBtn.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            soundBtn.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            handleInteraction();
        });
    </script>
</body>
</html>
