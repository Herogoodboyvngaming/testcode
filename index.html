<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MINI GAME ÄÆ¯á»¢C Táº O Bá»I NGUYá»„N CHÃ Dá»°</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="score-board">
        <p>ğŸ’° ÄIá»‚M Cá»¦A Báº N: <strong id="playerCoins">0</strong></p>
        <div class="login-info">
            <span id="userDisplay">KHÃCH</span>
            <button id="loginBtn" onclick="showLoginModal()">ÄÄ‚NG NHáº¬P</button>
            <button id="logoutBtn" onclick="logout()" style="display:none;">ÄÄ‚NG XUáº¤T</button>
        </div>
    </div>

    <div class="header">
        <h1>ğŸ® MINI GAME ÄÆ¯á»¢C Táº O Bá»I NGUYá»„N CHÃ Dá»° ğŸ‰</h1>
        <div class="subtitle">ğŸ¥³ CHÃšC CÃC Báº N CHÆ I MINI GAME VUI Váºº ğŸ¥³</div>
    </div>

    <p class="intro-text">CHá»ŒN Má»˜T MINI GAME Äá»‚ CHÆ I NÃ€O! ğŸš€</p>

    <div class="menu">
        <button onclick="showGame('snake')">ğŸ Ráº®N SÄ‚N Má»’I</button>
        <button onclick="showGame('tictactoe')">â­• Ã” Ä‚N QUAN (Cá»œ CARO)</button>
        <button onclick="showGame('flappy')">ğŸ¦ FLAPPY BIRD</button>
        <button onclick="showGame('shop')">ğŸ›’ SHOP MUA ITEM</button>
        <button class="info-btn" onclick="showInfo()">â„¹ï¸ THÃ”NG TIN & UPDATE</button>
    </div>

    <div id="mainScreen" class="game-container" style="display:block;">
        <h2>ğŸ  MÃ€N HÃŒNH CHÃNH</h2>
        <p>CHÃ€O Má»ªNG Báº N Äáº¾N Vá»šI Bá»˜ MINI GAME!</p>
        <p>CHá»ŒN TRÃ’ CHÆ I á» MENU TRÃŠN Äá»‚ Báº®T Äáº¦U CHÆ I NHÃ‰!</p>
        <div class="extra-buttons-main">
            <button onclick="showBugModal()">ğŸ› REPORT BUGS</button>
            <button onclick="showSuggestModal()">ğŸ’¡ Gá»¢I Ã TRÃ’ CHÆ I</button>
        </div>
    </div>

    <div id="snake" class="game-container">
        <h2>ğŸ Ráº®N SÄ‚N Má»’I</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ PC/MAC: PHÃM MÅ¨I TÃŠN â†‘ â† â†“ â†’</p>
            <p>ğŸ“± MOBILE: NÃšT ÄIá»€U HÆ¯á»šNG DÆ¯á»šI MÃ€N HÃŒNH</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="pauseGame()">â¸ Táº M Dá»ªNG</button>
            <button onclick="stopGame()">â¹ Dá»ªNG TRÃ’ CHÆ I</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I</button>
            <button onclick="confirmAbandon()">âŒ Tá»ª Bá» (-10 ÄIá»‚M)</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ CHÃNH</button>
        </div>
        <canvas id="snakeCanvas" width="400" height="400"></canvas>
        <div id="snakeScore" class="score">ÄIá»‚M HIá»†N Táº I: 0</div>
        <div id="snakeControls" class="mobile-controls">
            <button onclick="changeDirection('up')">â†‘</button>
            <div class="horizontal-controls">
                <button onclick="changeDirection('left')">â†</button>
                <button onclick="changeDirection('down')">â†“</button>
                <button onclick="changeDirection('right')">â†’</button>
            </div>
        </div>
    </div>

    <div id="tictactoe" class="game-container">
        <h2>â­• Ã” Ä‚N QUAN (Cá»œ CARO)</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ğŸ“± CLICK/CHáº M VÃ€O Ã” TRá»NG Äá»‚ Äáº¶T X (Báº N LÃ€ X, MÃY LÃ€ O)</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="pauseGame()">â¸ Táº M Dá»ªNG</button>
            <button onclick="stopGame()">â¹ Dá»ªNG TRÃ’ CHÆ I</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I</button>
            <button onclick="confirmAbandon()">âŒ Tá»ª Bá» (-10 ÄIá»‚M)</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ CHÃNH</button>
        </div>
        <table class="ttt-table">
            <tr>
                <td onclick="playTTT(0)"><h1 id="ttt0">&nbsp;</h1></td>
                <td onclick="playTTT(1)"><h1 id="ttt1">&nbsp;</h1></td>
                <td onclick="playTTT(2)"><h1 id="ttt2">&nbsp;</h1></td>
            </tr>
            <tr>
                <td onclick="playTTT(3)"><h1 id="ttt3">&nbsp;</h1></td>
                <td onclick="playTTT(4)"><h1 id="ttt4">&nbsp;</h1></td>
                <td onclick="playTTT(5)"><h1 id="ttt5">&nbsp;</h1></td>
            </tr>
            <tr>
                <td onclick="playTTT(6)"><h1 id="ttt6">&nbsp;</h1></td>
                <td onclick="playTTT(7)"><h1 id="ttt7">&nbsp;</h1></td>
                <td onclick="playTTT(8)"><h1 id="ttt8">&nbsp;</h1></td>
            </tr>
        </table>
        <p id="tttStatus" class="status"></p>
    </div>

    <div id="flappy" class="game-container">
        <h2>ğŸ¦ FLAPPY BIRD</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ PC/MAC: PHÃM SPACE HOáº¶C CLICK CHUá»˜T</p>
            <p>ğŸ“± MOBILE: CHáº M MÃ€N HÃŒNH Äá»‚ BAY LÃŠN</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="pauseGame()">â¸ Táº M Dá»ªNG</button>
            <button onclick="stopGame()">â¹ Dá»ªNG TRÃ’ CHÆ I</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I</button>
            <button onclick="confirmAbandon()">âŒ Tá»ª Bá» (-10 ÄIá»‚M)</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ CHÃNH</button>
        </div>
        <canvas id="flappyCanvas" width="400" height="500"></canvas>
        <div id="flappyScore" class="score">ÄIá»‚M HIá»†N Táº I: 0</div>
    </div>

    <div id="shop" class="game-container">
        <h2>ğŸ›’ SHOP MUA ITEM</h2>
        <p>DÃ™NG ÄIá»‚M KIáº¾M ÄÆ¯á»¢C Äá»‚ MUA SKIN VÃ€ HIá»†U á»¨NG Äáº¸P HÆ N!</p>
        <div class="shop-info">
            <p>ğŸ’° ÄIá»‚M HIá»†N Táº I: <strong id="playerCoinsShop">0</strong></p>
        </div>
        <div class="shop-items">
            <div class="shop-item">
                <span>ğŸ¨ SKIN Ráº®N XANH LÃ (Máº¶C Äá»ŠNH)</span>
                <button disabled>ÄÃƒ Sá» Há»®U</button>
            </div>
            <div class="shop-item">
                <span>ğŸ”¥ SKIN Ráº®N Lá»¬A Äá» (200 ÄIá»‚M)</span>
                <button id="buy-redSnake" onclick="buyItem('redSnake', 200)">MUA</button>
            </div>
            <div class="shop-item">
                <span>ğŸŒˆ SKIN Ráº®N Cáº¦U Vá»’NG (500 ÄIá»‚M)</span>
                <button id="buy-rainbowSnake" onclick="buyItem('rainbowSnake', 500)">MUA</button>
            </div>
            <div class="shop-item">
                <span>ğŸ¦¸ SKIN CHIM SIÃŠU ANH HÃ™NG (300 ÄIá»‚M)</span>
                <button id="buy-heroBird" onclick="buyItem('heroBird', 300)">MUA</button>
            </div>
        </div>
    </div>

    <div id="gameModal" class="modal">
        <div class="modal-content">
            <div id="fireworks" class="fireworks"></div>
            <div id="rain" class="rain"></div>
            <h2 id="modalTitle">ğŸ‰ CHÃšC Má»ªNG!</h2>
            <p id="modalMessage">Báº N ÄÃƒ THáº®NG Vá»šI ÄIá»‚M Sá» TUYá»†T Vá»œI!</p>
            <p id="modalExtra" style="display:none;">Báº N ÄÃƒ THUA, CÃ“ MUá»N CHÆ I Láº I KHÃ”NG? HÃƒY Báº¤M VÃ€O NÃšT BÃŠN DÆ¯á»šI!</p>
            <button class="restart-btn" onclick="restartCurrentGame()">ğŸ”„ CHÆ I Láº I</button>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>ÄÄ‚NG NHáº¬P / ÄÄ‚NG KÃ</h2>
            <input type="text" id="username" placeholder="TÃŠN ÄÄ‚NG NHáº¬P">
            <input type="password" id="password" placeholder="Máº¬T KHáº¨U">
            <button onclick="login()">ÄÄ‚NG NHáº¬P</button>
            <button onclick="register()">ÄÄ‚NG KÃ</button>
            <button onclick="closeLoginModal()">ÄÃ“NG</button>
        </div>
    </div>

    <div id="infoModal" class="modal">
        <div class="modal-content info-modal">
            <h2>â„¹ï¸ THÃ”NG TIN & UPDATE</h2>
            <div class="info-content">
                <p><strong>TÃC GIáº¢:</strong> NGUYá»„N CHÃ Dá»°</p>
                <p><strong>PHIÃŠN Báº¢N:</strong> 3.0</p>
                <p><strong>Lá»œI NHáº®N:</strong> CHÃšC CÃC Báº N CHÆ I VUI! â¤ï¸</p>
            </div>
            <button class="restart-btn" onclick="closeInfo()">ÄÃ“NG</button>
        </div>
    </div>

    <div id="bugModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ› REPORT BUGS</h2>
            <p>Gá»¬I Lá»–I Báº N Gáº¶P PHáº¢I Äá»‚ MÃŒNH Sá»¬A NHÃ‰!</p>
            <input type="email" id="bugEmail" placeholder="GMAIL Cá»¦A Báº N (Báº®T BUá»˜C)" required>
            <textarea id="bugMessage" placeholder="MÃ” Táº¢ Lá»–I CHI TIáº¾T" required></textarea>
            <p>GMAIL Há»– TRá»¢: <strong>Herogoodboymc2024@gmail.com</strong></p>
            <button class="restart-btn" onclick="sendBugReport()">Gá»¬I REPORT</button>
            <button class="restart-btn" onclick="closeBugModal()">ÄÃ“NG</button>
        </div>
    </div>

    <div id="suggestModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ’¡ Gá»¢I Ã TRÃ’ CHÆ I</h2>
            <p>Gá»¢I Ã TRÃ’ CHÆ I Má»šI Báº N MUá»N THÃŠM NHÃ‰!</p>
            <input type="email" id="suggestEmail" placeholder="GMAIL Cá»¦A Báº N (Báº®T BUá»˜C)" required>
            <textarea id="suggestMessage" placeholder="TÃŠN TRÃ’ CHÆ I HOáº¶C MÃ” Táº¢" required></textarea>
            <p>GMAIL Há»– TRá»¢: <strong>Herogoodboymc2024@gmail.com</strong></p>
            <button class="restart-btn" onclick="sendSuggest()">Gá»¬I Gá»¢I Ã</button>
            <button class="restart-btn" onclick="closeSuggestModal()">ÄÃ“NG</button>
        </div>
    </div>

    <div class="footer">
        <p>MADE IN VN ğŸ‡»ğŸ‡³</p>
        <p>MADE BY: NGUYá»„N CHÃ Dá»° â™¥ï¸ğŸ‡»ğŸ‡³</p>
    </div>

    <audio id="eatSound" preload="auto" src="https://www.myinstants.com/media/sounds/coin-mario.mp3"></audio>
    <audio id="jumpSound" preload="auto" src="https://www.myinstants.com/media/sounds/mario-jump.mp3"></audio>
    <audio id="gameOverSound" preload="auto" src="https://www.myinstants.com/media/sounds/mario-bros-game-over.mp3"></audio>
    <audio id="victorySound" preload="auto" src="https://www.myinstants.com/media/sounds/final-fantasy-victory-fanfare.mp3"></audio>

    <script>
        let currentGame = '';
        let playerCoins = 0;
        let ownedItems = ['defaultSnake'];
        let currentUser = null;
        let gameStarted = false;
        let flappyPaused = false;
        let flappyAnimationId = null;
        let snakeScore = 0;
        let flappyScore = 0;

        window.onload = () => {
            loadUser();
            adjustCanvasSize();
            showMainScreen();
        };

        function loadUser() {
            currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                playerCoins = parseInt(localStorage.getItem('coins_' + currentUser)) || 0;
                ownedItems = JSON.parse(localStorage.getItem('items_' + currentUser)) || ['defaultSnake'];
                document.getElementById('userDisplay').innerText = currentUser.toUpperCase();
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'block';
            } else {
                playerCoins = parseInt(localStorage.getItem('playerCoins')) || 0;
                ownedItems = JSON.parse(localStorage.getItem('ownedItems')) || ['defaultSnake'];
                document.getElementById('userDisplay').innerText = 'KHÃCH';
                document.getElementById('loginBtn').style.display = 'block';
                document.getElementById('logoutBtn').style.display = 'none';
            }
            document.getElementById('playerCoins').innerText = playerCoins;
            if (document.getElementById('playerCoinsShop')) document.getElementById('playerCoinsShop').innerText = playerCoins;
            updateShopButtons();
        }

        function saveCoins() {
            if (currentUser) {
                localStorage.setItem('coins_' + currentUser, playerCoins);
                localStorage.setItem('items_' + currentUser, JSON.stringify(ownedItems));
            } else {
                localStorage.setItem('playerCoins', playerCoins);
                localStorage.setItem('ownedItems', JSON.stringify(ownedItems));
            }
        }

        function addCoins(amount) {
            playerCoins += amount;
            document.getElementById('playerCoins').innerText = playerCoins;
            if (document.getElementById('playerCoinsShop')) document.getElementById('playerCoinsShop').innerText = playerCoins;
            saveCoins();
        }

        function showMainScreen() {
            document.querySelectorAll('.game-container').forEach(div => div.style.display = 'none');
            document.getElementById('mainScreen').style.display = 'block';
            currentGame = 'mainScreen';
            closeAllModals();
            adjustCanvasSize();
        }

        function showGame(gameId) {
            document.querySelectorAll('.game-container').forEach(div => div.style.display = 'none');
            document.getElementById(gameId).style.display = 'block';
            currentGame = gameId;
            gameStarted = false;
            closeAllModals();
            adjustCanvasSize();
            if (gameId === 'shop') {
                document.getElementById('playerCoinsShop').innerText = playerCoins;
            }
        }

        function closeAllModals() {
            document.getElementById('gameModal').style.display = 'none';
            document.getElementById('infoModal').style.display = 'none';
            document.getElementById('bugModal').style.display = 'none';
            document.getElementById('suggestModal').style.display = 'none';
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('fireworks').innerHTML = '';
            document.getElementById('rain').innerHTML = '';
            document.getElementById('modalExtra').style.display = 'none';
        }

        function confirmStart() {
            if (confirm('Báº N MUá»N Báº®T Äáº¦U CHÆ I?')) {
                gameStarted = true;
                if (currentGame === 'snake') initSnake();
                if (currentGame === 'flappy') initFlappy();
                if (currentGame === 'tictactoe') resetTTT();
            }
        }

        function confirmRestart() {
            if (confirm('Báº N Äá»’NG Ã CHÆ I Láº I? ÄIá»‚M Sáº¼ RESET Vá»€ 0!')) {
                restartCurrentGame();
            }
        }

        function confirmAbandon() {
            if (confirm('Báº N Äá»’NG Ã Tá»ª Bá»? Sáº¼ Bá»Š TRá»ª 10 ÄIá»‚M!')) {
                playerCoins = Math.max(0, playerCoins - 10);
                document.getElementById('playerCoins').innerText = playerCoins;
                saveCoins();
                showMainScreen();
            }
        }

        function confirmBackHome() {
            if (confirm('Báº N Äá»’NG Ã TRá» Vá»€ MÃ€N HÃŒNH CHÃNH?')) {
                showMainScreen();
            }
        }

        function restartCurrentGame() {
            document.getElementById('gameModal').style.display = 'none';
            showGame(currentGame);
            gameStarted = true;
            if (currentGame === 'snake') initSnake();
            if (currentGame === 'flappy') initFlappy();
            if (currentGame === 'tictactoe') resetTTT();
        }

        function showModal(title, message, isVictory = false, isLose = false) {
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalMessage').innerHTML = message;
            document.getElementById('modalExtra').style.display = isLose ? 'block' : 'none';
            document.getElementById('gameModal').style.display = 'flex';
            document.getElementById('fireworks').innerHTML = '';
            document.getElementById('rain').innerHTML = '';
            if (isVictory) createFireworks();
            else if (isLose) createRain();
            playSound(isVictory ? 'victorySound' : 'gameOverSound');
        }

        function createFireworks() {
            const fireworks = document.getElementById('fireworks');
            for (let i = 0; i < 30; i++) {
                const fw = document.createElement('div');
                fw.className = 'firework';
                fw.style.left = Math.random() * 100 + '%';
                fw.style.top = Math.random() * 100 + '%';
                fw.style.animationDelay = Math.random() * 1 + 's';
                fireworks.appendChild(fw);
            }
        }

        function createRain() {
            const rain = document.getElementById('rain');
            for (let i = 0; i < 50; i++) {
                const drop = document.createElement('div');
                drop.className = 'rain-drop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDelay = Math.random() * 2 + 's';
                drop.style.animationDuration = 1 + Math.random() * 1 + 's';
                rain.appendChild(drop);
            }
        }

        function playSound(id) {
            const sound = document.getElementById(id);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(() => {});
            }
        }

        function adjustCanvasSize() {
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                const maxWidth = Math.min(window.innerWidth - 40, 400);
                const ratio = canvas.height / canvas.width;
                canvas.style.width = `${maxWidth}px`;
                canvas.style.height = `${maxWidth * ratio}px`;
            });
        }
        window.addEventListener('resize', adjustCanvasSize);

        // PAUSE AND STOP GAME
        function pauseGame() {
            if (!gameStarted) return;
            if (confirm('Báº N MUá»N Táº M Dá»ªNG TRÃ’ CHÆ I?')) {
                if (currentGame === 'flappy') flappyPaused = true;
                alert('TRÃ’ CHÆ I ÄÃƒ Táº M Dá»ªNG. NHáº¤N OK Äá»‚ TIáº¾P Tá»¤C.');
                if (currentGame === 'flappy') {
                    flappyPaused = false;
                    flappyAnimationId = requestAnimationFrame(updateFlappy);
                }
            }
        }

        function stopGame() {
            if (!gameStarted) {
                alert('TRÃ’ CHÆ I CHÆ¯A Báº®T Äáº¦U!');
                return;
            }
            if (confirm('Báº N MUá»N Dá»ªNG TRÃ’ CHÆ I HOÃ€N TOÃ€N VÃ€ TRá» Vá»€ MÃ€N HÃŒNH CHÃNH KHÃ”NG?\nÄIá»‚M HIá»†N Táº I Sáº¼ ÄÆ¯á»¢C Cá»˜NG VÃ€O VÃ.')) {
                if (currentGame === 'snake') addCoins(snakeScore);
                if (currentGame === 'flappy') addCoins(Math.floor(flappyScore / 2));
                if (currentGame === 'flappy') cancelAnimationFrame(flappyAnimationId);
                gameStarted = false;
                showMainScreen();
            }
        }

        // Ráº®N SÄ‚N Má»’I
        let snakeCanvas, snakeCtx;
        let snake = [{x: 200, y: 200}];
        let dx = 10, dy = 0;
        let foodX, foodY;
        let lastFrameTime = 0;
        let frameInterval = 100;
        let pendingDirection = null;

        function initSnake() {
            snakeCanvas = document.getElementById('snakeCanvas');
            snakeCtx = snakeCanvas.getContext('2d');
            snakeScore = 0;
            document.getElementById('snakeScore').innerText = 'ÄIá»‚M HIá»†N Táº I: 0';
            snake = [{x: 200, y: 200}];
            dx = 10; dy = 0;
            pendingDirection = null;
            createFood();
            lastFrameTime = performance.now();
            requestAnimationFrame(updateSnake);
        }

        function createFood() {
            foodX = Math.floor(Math.random() * 40) * 10;
            foodY = Math.floor(Math.random() * 40) * 10;
        }

        function updateSnake(currentTime) {
            if (currentTime - lastFrameTime > frameInterval) {
                lastFrameTime = currentTime;

                if (pendingDirection) {
                    switch (pendingDirection) {
                        case 'up': if (dy === 0) { dx = 0; dy = -10; } break;
                        case 'down': if
