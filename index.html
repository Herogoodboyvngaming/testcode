<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MINI GAME ÄÆ¯á»¢C Táº O Bá»I NGUYá»„N CHÃ Dá»°</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="score-board">
        <p>ğŸ’° ÄIá»‚M Cá»¦A Báº N: <strong id="playerCoins">0</strong></p>
        <div class="login-info">
            <span id="userDisplay">KHÃCH</span>
            <button onclick="showLoginModal()">ÄÄ‚NG NHáº¬P</button>
            <button onclick="logout()">ÄÄ‚NG XUáº¤T</button>
        </div>
    </div>

    <div class="header">
        <h1>ğŸ® MINI GAME ÄÆ¯á»¢C Táº O Bá»I NGUYá»„N CHÃ Dá»° ğŸ‰</h1>
        <div class="subtitle">ğŸ¥³ CHÃšC CÃC Báº N CHÆ I MINI GAME VUI Váºº ğŸ¥³</div>
    </div>

    <p class="intro-text">CHá»ŒN Má»˜T MINI GAME Äá»‚ CHÆ I NÃ€O! ğŸš€</p>

    <div class="menu">
        <button onclick="showGame('snake')">ğŸ Ráº®N SÄ‚N Má»’I</button>
        <button onclick="showGame('tictactoe')">â­• Ã” Ä‚N QUAN (Cá»œ CARO)</button>
        <button onclick="showGame('flappy')">ğŸ¦ FLAPPY BIRD</button>
        <button onclick="showGame('pikachu')">ğŸ€„ PIKACHU GHÃ‰P Cáº¶P</button>
        <button onclick="showGame('dino')">ğŸ¦• DINO GAME</button>
        <button onclick="showGame('balloon')">ğŸˆ KHINH KHÃ Cáº¦U</button>
        <button onclick="showGame('shop')">ğŸ›’ SHOP MUA ITEM</button>
        <button class="info-btn" onclick="showInfo()">â„¹ï¸ THÃ”NG TIN & UPDATE</button>
    </div>

    <div id="mainScreen" class="game-container" style="display:block;">
        <h2>ğŸ  MÃ€N HÃŒNH CHÃNH</h2>
        <p>CHÃ€O Má»ªNG Báº N Äáº¾N Vá»šI Bá»˜ MINI GAME!</p>
        <p>CHá»ŒN TRÃ’ CHÆ I á» MENU TRÃŠN Äá»‚ Báº®T Äáº¦U CHÆ I NHÃ‰!</p>
        <div class="extra-buttons-main">
            <button onclick="showBugModal()">ğŸ› REPORT BUGS</button>
            <button onclick="showSuggestModal()">ğŸ’¡ Gá»¢I Ã TRÃ’ CHÆ I</button>
        </div>
    </div>

    <div id="snake" class="game-container">
        <h2>ğŸ Ráº®N SÄ‚N Má»’I</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ PC/MAC: PHÃM MÅ¨I TÃŠN â†‘ â† â†“ â†’</p>
            <p>ğŸ“± MOBILE: NÃšT ÄIá»€U HÆ¯á»šNG DÆ¯á»šI MÃ€N HÃŒNH</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="pauseSnake()">â¸ Táº M Dá»ªNG</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I (RESET ÄIá»‚M)</button>
            <button onclick="confirmAbandon()">âŒ Tá»ª Bá» (-10 ÄIá»‚M)</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ MÃ€N HÃŒNH CHÃNH</button>
        </div>
        <canvas id="snakeCanvas" width="400" height="400"></canvas>
        <div id="snakeScore" class="score">ÄIá»‚M HIá»†N Táº I: 0</div>
        <div id="snakeControls" class="mobile-controls">
            <button onclick="changeDirection('up')">â†‘</button>
            <div class="horizontal-controls">
                <button onclick="changeDirection('left')">â†</button>
                <button onclick="changeDirection('down')">â†“</button>
                <button onclick="changeDirection('right')">â†’</button>
            </div>
        </div>
    </div>

    <div id="tictactoe" class="game-container">
        <h2>â­• Ã” Ä‚N QUAN (Cá»œ CARO)</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ğŸ“± CLICK/CHáº M VÃ€O Ã” TRá»NG Äá»‚ Äáº¶T X (Báº N LÃ€ X, MÃY LÃ€ O)</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="pauseTictactoe()">â¸ Táº M Dá»ªNG</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I (RESET ÄIá»‚M)</button>
            <button onclick="confirmAbandon()">âŒ Tá»ª Bá» (-10 ÄIá»‚M)</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ MÃ€N HÃŒNH CHÃNH</button>
        </div>
        <table class="ttt-table">
            <tr>
                <td onclick="playTTT(0)"><h1 id="ttt0">&nbsp;</h1></td>
                <td onclick="playTTT(1)"><h1 id="ttt1">&nbsp;</h1></td>
                <td onclick="playTTT(2)"><h1 id="ttt2">&nbsp;</h1></td>
            </tr>
            <tr>
                <td onclick="playTTT(3)"><h1 id="ttt3">&nbsp;</h1></td>
                <td onclick="playTTT(4)"><h1 id="ttt4">&nbsp;</h1></td>
                <td onclick="playTTT(5)"><h1 id="ttt5">&nbsp;</h1></td>
            </tr>
            <tr>
                <td onclick="playTTT(6)"><h1 id="ttt6">&nbsp;</h1></td>
                <td onclick="playTTT(7)"><h1 id="ttt7">&nbsp;</h1></td>
                <td onclick="playTTT(8)"><h1 id="ttt8">&nbsp;</h1></td>
            </tr>
        </table>
        <p id="tttStatus" class="status"></p>
    </div>

    <div id="flappy" class="game-container">
        <h2>ğŸ¦ FLAPPY BIRD</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ PC/MAC: PHÃM SPACE HOáº¶C CLICK CHUá»˜T</p>
            <p>ğŸ“± MOBILE: CHáº M MÃ€N HÃŒNH Äá»‚ BAY LÃŠN</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="pauseFlappy()">â¸ Táº M Dá»ªNG</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I (RESET ÄIá»‚M)</button>
            <button onclick="confirmAbandon()">âŒ Tá»ª Bá» (-10 ÄIá»‚M)</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ MÃ€N HÃŒNH CHÃNH</button>
        </div>
        <canvas id="flappyCanvas" width="400" height="500"></canvas>
        <div id="flappyScore" class="score">ÄIá»‚M HIá»†N Táº I: 0 / 100</div>
    </div>

    <div id="pikachu" class="game-container">
        <h2>ğŸ€„ PIKACHU GHÃ‰P Cáº¶P</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ğŸ“± CLICK/CHáº M VÃ€O 2 Ã” GIá»NG NHAU Äá»‚ GHÃ‰P</p>
            <p>GHÃ‰P Háº¾T Äá»‚ THáº®NG!</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="pausePikachu()">â¸ Táº M Dá»ªNG</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I (RESET ÄIá»‚M)</button>
            <button onclick="confirmAbandon()">âŒ Tá»ª Bá» (-10 ÄIá»‚M)</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ MÃ€N HÃŒNH CHÃNH</button>
        </div>
        <div id="pikachuBoard"></div>
        <p id="pikachuStatus" class="status">CÃ’N Láº I: <span id="pairsLeft">8</span> Cáº¶P</p>
    </div>

    <div id="dino" class="game-container">
        <h2>ğŸ¦• DINO GAME</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ PC/MAC: PHÃM SPACE HOáº¶C CLICK Äá»‚ NHáº¢Y</p>
            <p>ğŸ“± MOBILE: CHáº M MÃ€N HÃŒNH Äá»‚ NHáº¢Y</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ MÃ€N HÃŒNH CHÃNH</button>
        </div>
        <canvas id="dinoCanvas" width="600" height="200"></canvas>
        <div id="dinoScore" class="score">ÄIá»‚M: 0</div>
    </div>

    <div id="balloon" class="game-container">
        <h2>ğŸˆ KHINH KHÃ Cáº¦U</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>Giá»¯ cháº¡m mÃ n hÃ¬nh / giá»¯ chuá»™t Ä‘á»ƒ bay lÃªn</p>
            <p>KÃ©o trÃ¡i/pháº£i Ä‘á»ƒ di chuyá»ƒn ngang</p>
            <p>Ä‚N NGÃ”I SAO VÃ€NG Äá»‚ TÄ‚NG ÄIá»‚M</p>
            <p>TRÃNH Äá»¤NG MÃ‚Y XÃM</p>
        </div>
        <div class="game-controls">
            <button onclick="confirmStart()">Báº®T Äáº¦U</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I</button>
            <button onclick="confirmBackHome()">ğŸ  TRá» Vá»€ MÃ€N HÃŒNH CHÃNH</button>
        </div>
        <canvas id="balloonCanvas" width="400" height="500"></canvas>
        <div id="balloonScore" class="score">ÄIá»‚M: 0</div>
    </div>

    <div id="shop" class="game-container">
        <h2>ğŸ›’ SHOP MUA ITEM</h2>
        <p>DÃ™NG ÄIá»‚M KIáº¾M ÄÆ¯á»¢C Äá»‚ MUA SKIN VÃ€ HIá»†U á»¨NG Äáº¸P HÆ N!</p>
        <div class="shop-info">
            <p>ğŸ’° ÄIá»‚M HIá»†N Táº I: <strong id="playerCoinsShop">0</strong></p>
        </div>
        <div class="shop-items">
            <div class="shop-item">
                <span>ğŸ¨ SKIN Ráº®N XANH LÃ (Máº¶C Äá»ŠNH)</span>
                <button disabled>ÄÃƒ Sá» Há»®U</button>
            </div>
            <div class="shop-item">
                <span>ğŸ”¥ SKIN Ráº®N Lá»¬A Äá» (200 ÄIá»‚M)</span>
                <button id="buy-redSnake" onclick="buyItem('redSnake', 200)">MUA</button>
            </div>
            <div class="shop-item">
                <span>ğŸŒˆ SKIN Ráº®N Cáº¦U Vá»’NG (500 ÄIá»‚M)</span>
                <button id="buy-rainbowSnake" onclick="buyItem('rainbowSnake', 500)">MUA</button>
            </div>
            <div class="shop-item">
                <span>ğŸ¦¸ SKIN CHIM SIÃŠU ANH HÃ™NG (300 ÄIá»‚M)</span>
                <button id="buy-heroBird" onclick="buyItem('heroBird', 300)">MUA</button>
            </div>
            <div class="shop-item">
                <span>âœ¨ HIá»†U á»¨NG GHÃ‰P ÄÃ”I Láº¤P LÃNH (400 ÄIá»‚M)</span>
                <button id="buy-sparkleMatch" onclick="buyItem('sparkleMatch', 400)">MUA</button>
            </div>
        </div>
    </div>

    <div id="gameModal" class="modal">
        <div class="modal-content">
            <div id="fireworks" class="fireworks"></div>
            <div id="rain" class="rain"></div>
            <h2 id="modalTitle">ğŸ‰ CHÃšC Má»ªNG!</h2>
            <p id="modalMessage">Báº N ÄÃƒ THáº®NG Vá»šI ÄIá»‚M Sá» TUYá»†T Vá»œI!</p>
            <p id="modalExtra" style="display:none;">Báº N ÄÃƒ THUA, CÃ“ MUá»N CHÆ I Láº I KHÃ”NG? HÃƒY Báº¤M VÃ€O NÃšT BÃŠN DÆ¯á»šI!</p>
            <button class="restart-btn" onclick="restartCurrentGame()">ğŸ”„ CHÆ I Láº I</button>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>ÄÄ‚NG NHáº¬P / ÄÄ‚NG KÃ</h2>
            <input type="text" id="username" placeholder="TÃŠN ÄÄ‚NG NHáº¬P">
            <input type="password" id="password" placeholder="Máº¬T KHáº¨U">
            <button onclick="login()">ÄÄ‚NG NHáº¬P</button>
            <button onclick="register()">ÄÄ‚NG KÃ</button>
            <button onclick="closeLoginModal()">ÄÃ“NG</button>
        </div>
    </div>

    <div id="infoModal" class="modal">
        <div class="modal-content info-modal">
            <h2>â„¹ï¸ THÃ”NG TIN & UPDATE</h2>
            <div class="info-content">
                <p><strong>TÃC GIáº¢:</strong> NGUYá»„N CHÃ Dá»°</p>
                <p><strong>PHIÃŠN Báº¢N:</strong> 3.0</p>
                <p><strong>Lá»œI NHáº®N:</strong> CHÃšC CÃC Báº N CHÆ I VUI! â¤ï¸</p>
            </div>
            <button class="restart-btn" onclick="closeInfo()">ÄÃ“NG</button>
        </div>
    </div>

    <div id="bugModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ› REPORT BUGS</h2>
            <p>Gá»¬I Lá»–I Báº N Gáº¶P PHáº¢I Äá»‚ MÃŒNH Sá»¬A NHÃ‰!</p>
            <input type="email" id="bugEmail" placeholder="GMAIL Cá»¦A Báº N (Báº®T BUá»˜C)" required>
            <textarea id="bugMessage" placeholder="MÃ” Táº¢ Lá»–I CHI TIáº¾T" required></textarea>
            <p>GMAIL Há»– TRá»¢: <strong>Herogoodboymc2024@gmail.com</strong></p>
            <button class="restart-btn" onclick="sendBugReport()">Gá»¬I REPORT</button>
            <button class="restart-btn" onclick="closeBugModal()">ÄÃ“NG</button>
        </div>
    </div>

    <div id="suggestModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ’¡ Gá»¢I Ã TRÃ’ CHÆ I</h2>
            <p>Gá»¢I Ã TRÃ’ CHÆ I Má»šI Báº N MUá»N THÃŠM NHÃ‰!</p>
            <input type="email" id="suggestEmail" placeholder="GMAIL Cá»¦A Báº N (Báº®T BUá»˜C)" required>
            <textarea id="suggestMessage" placeholder="TÃŠN TRÃ’ CHÆ I HOáº¶C MÃ” Táº¢" required></textarea>
            <p>GMAIL Há»– TRá»¢: <strong>Herogoodboymc2024@gmail.com</strong></p>
            <button class="restart-btn" onclick="sendSuggest()">Gá»¬I Gá»¢I Ã</button>
            <button class="restart-btn" onclick="closeSuggestModal()">ÄÃ“NG</button>
        </div>
    </div>

    <div class="footer">
        <p>MADE IN VN ğŸ‡»ğŸ‡³</p>
        <p>MADE BY: NGUYá»„N CHÃ Dá»° â™¥ï¸ğŸ‡»ğŸ‡³</p>
    </div>

    <audio id="eatSound" preload="auto" src="https://www.myinstants.com/media/sounds/coin-mario.mp3"></audio>
    <audio id="jumpSound" preload="auto" src="https://www.myinstants.com/media/sounds/mario-jump.mp3"></audio>
    <audio id="matchSound" preload="auto" src="https://www.myinstants.com/media/sounds/success-chime-49738.mp3"></audio>
    <audio id="gameOverSound" preload="auto" src="https://www.myinstants.com/media/sounds/mario-bros-game-over.mp3"></audio>
    <audio id="victorySound" preload="auto" src="https://www.myinstants.com/media/sounds/final-fantasy-victory-fanfare.mp3"></audio>

    <script>
        let currentGame = '';
        let playerCoins = 0;
        let ownedItems = ['defaultSnake'];
        let currentUser = null;
        let gameStarted = false;
        let flappyPaused = false;
        let flappyAnimationId = null;

        window.onload = () => {
            loadUser();
            adjustCanvasSize();
            showMainScreen();
        };

        function loadUser() {
            currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                playerCoins = parseInt(localStorage.getItem('coins_' + currentUser)) || 0;
                ownedItems = JSON.parse(localStorage.getItem('items_' + currentUser)) || ['defaultSnake'];
                document.getElementById('userDisplay').innerText = currentUser.toUpperCase();
            } else {
                playerCoins = parseInt(localStorage.getItem('playerCoins')) || 0;
                ownedItems = JSON.parse(localStorage.getItem('ownedItems')) || ['defaultSnake'];
            }
            document.getElementById('playerCoins').innerText = playerCoins;
            if (document.getElementById('playerCoinsShop')) document.getElementById('playerCoinsShop').innerText = playerCoins;
            updateShopButtons();
        }

        function saveCoins() {
            if (currentUser) {
                localStorage.setItem('coins_' + currentUser, playerCoins);
                localStorage.setItem('items_' + currentUser, JSON.stringify(ownedItems));
            } else {
                localStorage.setItem('playerCoins', playerCoins);
                localStorage.setItem('ownedItems', JSON.stringify(ownedItems));
            }
        }

        function addCoins(amount) {
            playerCoins += amount;
            document.getElementById('playerCoins').innerText = playerCoins;
            if (document.getElementById('playerCoinsShop')) document.getElementById('playerCoinsShop').innerText = playerCoins;
            saveCoins();
        }

        function showMainScreen() {
            document.querySelectorAll('.game-container').forEach(div => div.style.display = 'none');
            document.getElementById('mainScreen').style.display = 'block';
            currentGame = 'mainScreen';
            closeAllModals();
            adjustCanvasSize();
        }

        function showGame(gameId) {
            document.querySelectorAll('.game-container').forEach(div => div.style.display = 'none');
            document.getElementById(gameId).style.display = 'block';
            currentGame = gameId;
            gameStarted = false;
            closeAllModals();
            adjustCanvasSize();
            if (gameId === 'shop') {
                document.getElementById('playerCoinsShop').innerText = playerCoins;
            }
        }

        function closeAllModals() {
            document.getElementById('gameModal').style.display = 'none';
            document.getElementById('infoModal').style.display = 'none';
            document.getElementById('bugModal').style.display = 'none';
            document.getElementById('suggestModal').style.display = 'none';
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('fireworks').innerHTML = '';
            document.getElementById('rain').innerHTML = '';
            document.getElementById('modalExtra').style.display = 'none';
        }

        function confirmStart() {
            if (confirm('Báº N MUá»N Báº®T Äáº¦U CHÆ I?')) {
                gameStarted = true;
                if (currentGame === 'snake') initSnake();
                if (currentGame === 'flappy') initFlappy();
                if (currentGame === 'pikachu') initPikachu();
                if (currentGame === 'tictactoe') resetTTT();
                if (currentGame === 'dino') initDino();
                if (currentGame === 'balloon') initBalloon();
            }
        }

        function confirmRestart() {
            if (confirm('Báº N Äá»’NG Ã CHÆ I Láº I? ÄIá»‚M Sáº¼ RESET Vá»€ 0!')) {
                restartCurrentGame();
            }
        }

        function confirmAbandon() {
            if (confirm('Báº N Äá»’NG Ã Tá»ª Bá»? Sáº¼ Bá»Š TRá»ª 10 ÄIá»‚M!')) {
                playerCoins = Math.max(0, playerCoins - 10);
                localStorage.setItem('playerCoins', playerCoins);
                document.getElementById('playerCoins').innerText = playerCoins;
                showMainScreen();
            }
        }

        function confirmBackHome() {
            if (confirm('Báº N Äá»’NG Ã TRá» Vá»€ MÃ€N HÃŒNH CHÃNH?')) {
                showMainScreen();
            }
        }

        function restartCurrentGame() {
            document.getElementById('gameModal').style.display = 'none';
            showGame(currentGame);
            gameStarted = true;
            if (currentGame === 'snake') initSnake();
            if (currentGame === 'flappy') initFlappy();
            if (currentGame === 'pikachu') initPikachu();
            if (currentGame === 'tictactoe') resetTTT();
            if (currentGame === 'dino') initDino();
            if (currentGame === 'balloon') initBalloon();
        }

        function showModal(title, message, isVictory = false, isLose = false) {
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalMessage').innerHTML = message;
            document.getElementById('modalExtra').style.display = isLose ? 'block' : 'none';
            document.getElementById('gameModal').style.display = 'flex';
            document.getElementById('fireworks').innerHTML = '';
            document.getElementById('rain').innerHTML = '';
            if (isVictory) {
                createFireworks();
            } else if (isLose) {
                createRain();
            }
            playSound(isVictory ? 'victorySound' : 'gameOverSound');
        }

        function createFireworks() {
            const fireworks = document.getElementById('fireworks');
            for (let i = 0; i < 30; i++) {
                const fw = document.createElement('div');
                fw.className = 'firework';
                fw.style.left = Math.random() * 100 + '%';
                fw.style.top = Math.random() * 100 + '%';
                fw.style.animationDelay = Math.random() * 1 + 's';
                fireworks.appendChild(fw);
            }
        }

        function createRain() {
            const rain = document.getElementById('rain');
            for (let i = 0; i < 50; i++) {
                const drop = document.createElement('div');
                drop.className = 'rain-drop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDelay = Math.random() * 2 + 's';
                drop.style.animationDuration = 1 + Math.random() * 1 + 's';
                rain.appendChild(drop);
            }
        }

        function playSound(id) {
            const sound = document.getElementById(id);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(() => {});
            }
        }

        function adjustCanvasSize() {
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                const maxWidth = Math.min(window.innerWidth - 40, 400);
                const ratio = canvas.height / canvas.width;
                canvas.style.width = `${maxWidth}px`;
                canvas.style.height = `${maxWidth * ratio}px`;
            });
        }
        window.addEventListener('resize', adjustCanvasSize);

        // Ráº®N SÄ‚N Má»’I
        let snakeCanvas, snakeCtx, snakeScore = 0;
        let snake = [{x: 200, y: 200}];
        let dx = 10, dy = 0;
        let foodX, foodY;
        let lastFrameTime = 0;
        let frameInterval = 100;
        let pendingDirection = null;

        function initSnake() {
            snakeCanvas = document.getElementById('snakeCanvas');
            snakeCtx = snakeCanvas.getContext('2d');
            snakeScore = 0;
            document.getElementById('snakeScore').innerText = 'ÄIá»‚M HIá»†N Táº I: 0';
            snake = [{x: 200, y: 200}];
            dx = 10; dy = 0;
            pendingDirection = null;
            createFood();
            lastFrameTime = performance.now();
            requestAnimationFrame(updateSnake);
        }

        function createFood() {
            foodX = Math.floor(Math.random() * 40) * 10;
            foodY = Math.floor(Math.random() * 40) * 10;
        }

        function updateSnake(currentTime) {
            if (currentTime - lastFrameTime > frameInterval) {
                lastFrameTime = currentTime;

                if (pendingDirection) {
                    switch (pendingDirection) {
                        case 'up': if (dy === 0) { dx = 0; dy = -10; } break;
                        case 'down': if (dy === 0) { dx = 0; dy = 10; } break;
                        case 'left': if (dx === 0) { dx = -10; dy = 0; } break;
                        case 'right': if (dx === 0) { dx = 10; dy = 0; } break;
                    }
                    pendingDirection = null;
                }

                snakeCtx.clearRect(0, 0, snakeCanvas.width, snakeCanvas.height);

                let snakeColor = ownedItems.includes('redSnake') ? '#e74c3c' : '#4CAF50';
                snake.forEach(part => {
                    snakeCtx.fillStyle = snakeColor;
                    snakeCtx.fillRect(part.x, part.y, 10, 10);
                    snakeCtx.strokeStyle = '#388E3C';
                    snakeCtx.strokeRect(part.x, part.y, 10, 10);
                });

                snakeCtx.fillStyle = '#FF5722';
                snakeCtx.fillRect(foodX, foodY, 10, 10);

                let head = {x: snake[0].x + dx, y: snake[0].y + dy};

                if (head.x < 0 || head.x >= snakeCanvas.width || head.y < 0 || head.y >= snakeCanvas.height || snake.slice(1).some(part => part.x === head.x && part.y === head.y)) {
                    addCoins(snakeScore);
                    showModal('ğŸ’” Báº N ÄÃƒ THUA!', `Báº N Äáº T <strong>${snakeScore}</strong> ÄIá»‚M!<br>CÃ“ MUá»N CHÆ I Láº I KHÃ”NG? HÃƒY Báº¤M VÃ€O NÃšT BÃŠN DÆ¯á»šI!`, false, true);
                    return;
                }

                snake.unshift(head);

                if (head.x === foodX && head.y === foodY) {
                    snakeScore++;
                    document.getElementById('snakeScore').innerText = 'ÄIá»‚M HIá»†N Táº I: ' + snakeScore;
                    createFood();
                    playSound('eatSound');
                } else {
                    snake.pop();
                }
            }
            requestAnimationFrame(updateSnake);
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp') pendingDirection = 'up';
            if (e.key === 'ArrowDown') pendingDirection = 'down';
            if (e.key === 'ArrowLeft') pendingDirection = 'left';
            if (e.key === 'ArrowRight') pendingDirection = 'right';
        });

        function changeDirection(dir) {
            pendingDirection = dir;
        }

        // Cá»œ CARO
        let tttBoard = Array(9).fill(null);

        function playTTT(index) {
            if (tttBoard[index] || checkWinner(tttBoard)) return;
            tttBoard[index] = 'X';
            document.getElementById('ttt' + index).innerText = 'X';
            if (checkWinner(tttBoard)) {
                addCoins(50);
                showModal('ğŸ‰ CHÃšC Má»ªNG!', 'Báº N THáº®NG Cá»œ CARO!<br>+50 ğŸ’° THÆ¯á»NG!', true);
                return;
            }
            if (tttBoard.every(cell => cell)) {
                addCoins(10);
                showModal('ğŸ¤ HÃ’A NHAU!', 'HÃ’A VÃN NÃ€Y!<br>+10 ğŸ’° AN á»¦I', false);
                return;
            }
            setTimeout(computerMove, 500);
        }

        function computerMove() {
            let bestMove = -1;
            for (let i = 0; i < 9; i++) {
                if (!tttBoard[i]) {
                    tttBoard[i] = 'X';
                    if (checkWinner(tttBoard)) { bestMove = i; tttBoard[i] = null; break; }
                    tttBoard[i] = null;
                }
            }
            if (bestMove === -1) {
                for (let i = 0; i < 9; i++) {
                    if (!tttBoard[i]) {
                        tttBoard[i] = 'O';
                        if (checkWinner(tttBoard)) { bestMove = i; tttBoard[i] = null; break; }
                        tttBoard[i] = null;
                    }
                }
            }
            if (bestMove === -1) {
                let available = tttBoard.map((v, i) => v === null ? i : null).filter(v => v !== null);
                bestMove = available[Math.floor(Math.random() * available.length)];
            }
            tttBoard[bestMove] = 'O';
            document.getElementById('ttt' + bestMove).innerText = 'O';
            if (checkWinner(tttBoard)) {
                addCoins(5);
                showModal('ğŸ¤– MÃY THáº®NG!', 'MÃY THáº®NG Rá»’I!<br>+5 ğŸ’° AN á»¦I', false);
            } else if (tttBoard.every(cell => cell)) {
                addCoins(10);
                showModal('ğŸ¤ HÃ’A NHAU!', 'Láº I HÃ’A!<br>+10 ğŸ’°', false);
            }
        }

        function checkWinner(board) {
            const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return wins.some(combo => combo.every(i => board[i] === board[combo[0]] && board[i]));
        }

        function resetTTT() {
            tttBoard = Array(9).fill(null);
            for (let i = 0; i < 9; i++) document.getElementById('ttt' + i).innerText = ' ';
            document.getElementById('tttStatus').innerText = '';
        }

        // FLAPPY BIRD
        let flappyCanvas, flappyCtx, birdY = 250, birdVelocity = 0, pipes = [], flappyScore = 0;
        let gravity = 0.5, jump = -10;

        function initFlappy() {
            flappyCanvas = document.getElementById('flappyCanvas');
            flappyCtx = flappyCanvas.getContext('2d');
            birdY = 250; birdVelocity = 0; pipes = []; flappyScore = 0;
            flappyPaused = false;
            document.getElementById('flappyScore').innerText = 'ÄIá»‚M HIá»†N Táº I: 0 / 100';
            pipes.push({x: 400, gap: Math.random() * 150 + 100});
            flappyAnimationId = requestAnimationFrame(updateFlappy);
        }

        function updateFlappy() {
            if (flappyPaused) return;

            flappyCtx.clearRect(0, 0, flappyCanvas.width, flappyCanvas.height);
            birdVelocity += gravity;
            birdY += birdVelocity;

            if (birdY > flappyCanvas.height - 20 || birdY < 0) {
                addCoins(Math.floor(flappyScore / 2));
                showModal('ğŸ’¥ Báº N ÄÃƒ THUA!', `Báº N Äáº T <strong>${flappyScore}</strong> ÄIá»‚M!<br>CÃ“ MUá»N CHÆ I Láº I KHÃ”NG? HÃƒY Báº¤M VÃ€O NÃšT BÃŠN DÆ¯á»šI!`, false, true);
                return;
            }

            flappyCtx.fillStyle = ownedItems.includes('heroBird') ? '#e74c3c' : '#FFEB3B';
            flappyCtx.fillRect(50, birdY, 30, 20);
            flappyCtx.fillStyle = '#000';
            flappyCtx.fillRect(75, birdY + 5, 10, 8);

            pipes.forEach(pipe => {
                pipe.x -= 2;
                flappyCtx.fillStyle = '#4CAF50';
                flappyCtx.fillRect(pipe.x, 0, 50, pipe.gap);
                flappyCtx.fillRect(pipe.x, pipe.gap + 150, 50, flappyCanvas.height - pipe.gap - 150);

                if (pipe.x + 50 === 80) {
                    flappyScore++;
                    document.getElementById('flappyScore').innerText = 'ÄIá»‚M HIá»†N Táº I: ' + flappyScore + ' / 100';
                    playSound('eatSound');
                    if (flappyScore >= 100) {
                        addCoins(200);
                        showModal('ğŸ‰ CHÃšC Má»ªNG WIN!', 'Báº N ÄÃƒ Äáº T 100 ÄIá»‚M!<br>+200 ğŸ’° THÆ¯á»NG Lá»šN!', true);
                        return;
                    }
                }

                if (pipe.x < 80 && pipe.x > 20 && (birdY < pipe.gap || birdY + 20 > pipe.gap + 150)) {
                    addCoins(Math.floor(flappyScore / 2));
                    showModal('ğŸ’¥ Báº N ÄÃƒ THUA!', `Báº N Äáº T <strong>${flappyScore}</strong> ÄIá»‚M!<br>CÃ“ MUá»N CHÆ I Láº I KHÃ”NG? HÃƒY Báº¤M VÃ€O NÃšT BÃŠN DÆ¯á»šI!`, false, true);
                    return;
                }
            });

            if (pipes[pipes.length-1].x < 200) pipes.push({x: 400, gap: Math.random() * 150 + 100});
            if (pipes[0].x < -50) pipes.shift();

            flappyAnimationId = requestAnimationFrame(updateFlappy);
        }

        document.addEventListener('keydown', e => { if (e.key === ' ') { birdVelocity = jump; playSound('jumpSound'); } });
        flappyCanvas.addEventListener('click', () => { birdVelocity = jump; playSound('jumpSound'); });
        flappyCanvas.addEventListener('touchstart', e => { e.preventDefault(); birdVelocity = jump; playSound('jumpSound'); });

        // PIKACHU
        const emojis = ['ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼'];
        let pikachuCards = [...emojis, ...emojis];
        let selected = [];

        function initPikachu() {
            pikachuCards.sort(() => Math.random() - 0.5);
            const board = document.getElementById('pikachuBoard');
            board.innerHTML = '';
            pikachuCards.forEach((emoji, i) => {
                const card = document.createElement('div');
                card.className = 'pikachu-card';
                card.innerText = '';
                card.onclick = () => flipCard(card, emoji);
                card.ontouchstart = () => flipCard(card, emoji);
                board.appendChild(card);
            });
            document.getElementById('pairsLeft').innerText = '8';
        }

        function flipCard(card, emoji) {
            if (card.innerText !== '' || selected.length === 2) return;
            card.innerText = emoji;
            card.style.background = '#fff';
            selected.push({card, emoji});
            if (selected.length === 2) {
                if (selected[0].emoji === selected[1].emoji) {
                    let matchBg = ownedItems.includes('sparkleMatch') ? 'linear-gradient(135deg, #ff9a9e, #fad0c4)' : '#a8e6cf';
                    selected[0].card.style.background = matchBg;
                    selected[1].card.style.background = matchBg;
                    selected[0].card.style.cursor = 'default';
                    selected[1].card.style.cursor = 'default';
                    playSound('matchSound');
                    let pairs = parseInt(document.getElementById('pairsLeft').innerText) - 1;
                    document.getElementById('pairsLeft').innerText = pairs;
                    if (pairs === 0) {
                        addCoins(100);
                        showModal('ğŸ‰ TUYá»†T Vá»œI!', 'Báº N ÄÃƒ GHÃ‰P Háº¾T!<br>+100 ğŸ’° THÆ¯á»NG Lá»šN!', true);
                    }
                } else {
                    setTimeout(() => {
                        selected[0].card.innerText = '';
                        selected[1].card.innerText = '';
                        selected[0].card.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                        selected[1].card.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                    }, 800);
                }
                selected = [];
            }
        }

        // DINO GAME
        let dinoCanvas, dinoCtx, dinoX = 50, dinoY = 150, dinoVelocity = 0, obstacles = [], dinoScore = 0;
        let dinoRunning = false;
        let endingShown = false;

        function initDino() {
            dinoCanvas = document.getElementById('dinoCanvas');
            dinoCtx = dinoCanvas.getContext('2d');
            dinoX = 50; dinoY = 150; dinoVelocity = 0; obstacles = []; dinoScore = 0; endingShown = false;
            document.getElementById('dinoScore').innerText = 'ÄIá»‚M: 0';
            dinoRunning = true;
            requestAnimationFrame(updateDino);
        }

        function updateDino() {
            if (!dinoRunning) return;
            dinoCtx.clearRect(0, 0, dinoCanvas.width, dinoCanvas.height);
            dinoVelocity += 0.5;
            dinoY += dinoVelocity;
            if (dinoY > 150) dinoY = 150, dinoVelocity = 0;

            dinoCtx.fillStyle = '#000';
            dinoCtx.fillRect(dinoX, dinoY, 40, 50);

            if (Math.random() < 0.02) obstacles.push({x: 600, y: 170, w: 20, h: 30});

            obstacles.forEach((obs, i) => {
                obs.x -= 5;
                dinoCtx.fillRect(obs.x, obs.y, obs.w, obs.h);
                if (obs.x < dinoX + 40 && obs.x + obs.w > dinoX && dinoY + 50 > obs.y) {
                    dinoRunning = false;
                    addCoins(dinoScore);
                    if (dinoScore >= 9999 && !endingShown) {
                        endingShown = true;
                        showModal('ğŸ’” Káº¾T THÃšC BUá»’N...', 'DINO GIRL ÄÃƒ CÃ“ NGÆ¯á»œI Má»šI... CÃ” áº¤Y CHIA TAY Báº N Rá»’I ğŸ˜­', false);
                    } else {
                        showModal('ğŸ’¥ Báº N ÄÃƒ THUA!', `Äáº T \( {dinoScore} ÄIá»‚M!<br>+ \){dinoScore} ğŸ’°`, false, true);
                    }
                    return;
                }
                if (obs.x < 0) obstacles.splice(i, 1);
            });

            dinoScore++;
            document.getElementById('dinoScore').innerText = 'ÄIá»‚M: ' + dinoScore;
            requestAnimationFrame(updateDino);
        }

        document.addEventListener('keydown', e => { if (e.key === ' ' && dinoRunning) dinoVelocity = -12; });
        dinoCanvas.addEventListener('click', () => { if (dinoRunning) dinoVelocity = -12; });
        dinoCanvas.addEventListener('touchstart', e => { e.preventDefault(); if (dinoRunning) dinoVelocity = -12; });

        // KHINH KHÃ Cáº¦U - Cáº¬P NHáº¬T ÄÃšNG YÃŠU Cáº¦U
        let balloonCanvas, balloonCtx, balloonX = 200, balloonY = 300, balloonVelocityY = 0, balloonVelocityX = 0;
        let stars = [], clouds = [], balloonScore = 0;
        let balloonRunning = false;
        let isHolding = false;
        let touchX = 0;

        function initBalloon() {
            balloonCanvas = document.getElementById('balloonCanvas');
            balloonCtx = balloonCanvas.getContext('2d');
            balloonX = 200; balloonY = 300; balloonVelocityY = 0; balloonVelocityX = 0;
            stars = []; clouds = []; balloonScore = 0;
            document.getElementById('balloonScore').innerText = 'ÄIá»‚M: 0';
            balloonRunning = true;
            requestAnimationFrame(updateBalloon);
        }

        function updateBalloon() {
            if (!balloonRunning) return;

            balloonCtx.clearRect(0, 0, balloonCanvas.width, balloonCanvas.height);

            if (isHolding) {
                balloonVelocityY = -3;
            } else {
                balloonVelocityY += 0.3;
            }
            balloonY += balloonVelocityY;
            balloonX += balloonVelocityX;
            balloonVelocityX *= 0.95;

            if (balloonY < 50 || balloonY > balloonCanvas.height - 100 || balloonX < 50 || balloonX > balloonCanvas.width - 50) {
                balloonRunning = false;
                addCoins(balloonScore);
                showModal('ğŸ’¥ Báº N ÄÃƒ THUA!', `Báº N Äáº T <strong>\( {balloonScore}</strong> ÄIá»‚M!<br>+ \){balloonScore} ğŸ’°`, false, true);
                return;
            }

            // Váº¼ KHINH KHÃ Cáº¦U
            balloonCtx.fillStyle = '#E91E63';
            balloonCtx.beginPath();
            balloonCtx.arc(balloonX, balloonY, 50, 0, Math.PI * 2);
            balloonCtx.fill();
            balloonCtx.fillStyle = '#FF9800';
            balloonCtx.fillRect(balloonX - 25, balloonY + 50, 50, 60);

            // Táº O NGÃ”I SAO VÃ€ MÃ‚Y
            if (Math.random() < 0.02) stars.push({x: 400, y: Math.random() * (balloonCanvas.height - 100) + 50});
            if (Math.random() < 0.015) clouds.push({x: 400, y: Math.random() * (balloonCanvas.height - 100) + 50});

            stars.forEach((star, i) => {
                star.x -= 3;
                balloonCtx.fillStyle = '#FFD700';
                balloonCtx.font = '30px Arial';
                balloonCtx.fillText('â­', star.x, star.y);
                if (Math.abs(star.x - balloonX) < 50 && Math.abs(star.y - balloonY) < 60) {
                    balloonScore += 10;
                    document.getElementById('balloonScore').innerText = 'ÄIá»‚M: ' + balloonScore;
                    playSound('eatSound');
                    stars.splice(i, 1);
                }
                if (star.x < 0) stars.splice(i, 1);
            });

            clouds.forEach((cloud, i) => {
                cloud.x -= 3;
                balloonCtx.fillStyle = '#9E9E9E';
                balloonCtx.fillRect(cloud.x, cloud.y - 30, 100, 60);
                if (Math.abs(cloud.x + 50 - balloonX) < 70 && Math.abs(cloud.y - balloonY) < 80) {
                    balloonRunning = false;
                    addCoins(balloonScore);
                    showModal('ğŸ’¥ Báº N ÄÃƒ THUA!', `Báº N Äáº T <strong>\( {balloonScore}</strong> ÄIá»‚M!<br>+ \){balloonScore} ğŸ’°`, false, true);
                    return;
                }
                if (cloud.x < 0) clouds.splice(i, 1);
            });

            requestAnimationFrame(updateBalloon);
        }

        balloonCanvas.addEventListener('mousedown', e => {
            isHolding = true;
            touchX = e.clientX;
        });
        balloonCanvas.addEventListener('mousemove', e => {
            if (isHolding) {
                balloonVelocityX = (e.clientX - touchX) * 0.1;
                touchX = e.clientX;
            }
        });
        balloonCanvas.addEventListener('mouseup', () => isHolding = false);
        balloonCanvas.addEventListener('mouseleave', () => isHolding = false);

        balloonCanvas.addEventListener('touchstart', e => {
            isHolding = true;
            touchX = e.touches[0].clientX;
            e.preventDefault();
        });
        balloonCanvas.addEventListener('touchmove', e => {
            if (isHolding) {
                balloonVelocityX = (e.touches[0].clientX - touchX) * 0.2;
                touchX = e.touches[0].clientX;
            }
            e.preventDefault();
        });
        balloonCanvas.addEventListener('touchend', () => isHolding = false);

        // SHOP, LOGIN, MODAL GIá»® NGUYÃŠN NHÆ¯ TRÆ¯á»šC

        function showInfo() {
            document.getElementById('infoModal').style.display = 'flex';
        }

        function closeInfo() {
            document.getElementById('infoModal').style.display = 'none';
        }

        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        function register() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value;
            if (user && pass) {
                localStorage.setItem('pass_' + user, pass);
                alert('ÄÄ‚NG KÃ THÃ€NH CÃ”NG!');
                closeLoginModal();
            }
        }

        function login() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value;
            if (user && pass && localStorage.getItem('pass_' + user) === pass) {
                currentUser = user;
                localStorage.setItem('currentUser', user);
                alert('ÄÄ‚NG NHáº¬P THÃ€NH CÃ”NG!');
                loadUser();
                closeLoginModal();
            } else {
                alert('SAI TÃŠN HOáº¶C Máº¬T KHáº¨U!');
            }
        }

        function logout() {
            if (confirm('ÄÄ‚NG XUáº¤T?')) {
                localStorage.removeItem('currentUser');
                currentUser = null;
                saveCoins();
                loadUser();
            }
        }

        function updateShopButtons() {
            const buttons = {
                'redSnake': 'buy-redSnake',
                'rainbowSnake': 'buy-rainbowSnake',
                'heroBird': 'buy-heroBird',
                'sparkleMatch': 'buy-sparkleMatch'
            };
            Object.keys(buttons).forEach(item => {
                const btn = document.getElementById(buttons[item]);
                if (btn) {
                    if (ownedItems.includes(item)) {
                        btn.innerText = 'ÄÃƒ Sá» Há»®U';
                        btn.disabled = true;
                    } else {
                        btn.innerText = 'MUA';
                        btn.disabled = false;
                    }
                }
            });
        }

        function buyItem(item, cost) {
            if (playerCoins >= cost && !ownedItems.includes(item)) {
                playerCoins -= cost;
                ownedItems.push(item);
                saveCoins();
                document.getElementById('playerCoins').innerText = playerCoins;
                document.getElementById('playerCoinsShop').innerText = playerCoins;
                alert('ğŸ‰ MUA THÃ€NH CÃ”NG! ITEM ÄÃƒ ÄÆ¯á»¢C THÃŠM VÃ€O KHO.');
                updateShopButtons();
            } else if (ownedItems.includes(item)) {
                alert('Báº N ÄÃƒ Sá» Há»®U ITEM NÃ€Y Rá»’I!');
            } else {
                alert('KHÃ”NG Äá»¦ ÄIá»‚M Äá»‚ MUA!');
            }
        }

        function showBugModal() {
            document.getElementById('bugModal').style.display = 'flex';
        }

        function closeBugModal() {
            document.getElementById('bugModal').style.display = 'none';
        }

        function sendBugReport() {
            const email = document.getElementById('bugEmail').value.trim();
            const message = document.getElementById('bugMessage').value.trim();
            if (email && message) {
                alert('Cáº¢M Æ N Báº N ÄÃƒ BÃO CÃO Lá»–I, MÃŒNH Sáº¼ Sá»šM Sá»¬A Lá»–I TRONG VÃ’NG 24H HOáº¶C HÆ N Náº¾U MÃŒNH Báº¬N');
                document.getElementById('bugEmail').value = '';
                document.getElementById('bugMessage').value = '';
                closeBugModal();
            } else {
                alert('VUI LÃ’NG NHáº¬P Äáº¦Y Äá»¦ GMAIL VÃ€ TIN NHáº®N!');
            }
        }

        function showSuggestModal() {
            document.getElementById('suggestModal').style.display = 'flex';
        }

        function closeSuggestModal() {
            document.getElementById('suggestModal').style.display = 'none';
        }

        function sendSuggest() {
            const email = document.getElementById('suggestEmail').value.trim();
            const message = document.getElementById('suggestMessage').value.trim();
            if (email && message) {
                alert('Cáº¢M Æ N Gá»¢I Ã Cá»¦A Báº N! MÃŒNH Sáº¼ XEM XÃ‰T THÃŠM TRÃ’ Má»šI â¤ï¸');
                document.getElementById('suggestEmail').value = '';
                document.getElementById('suggestMessage').value = '';
                closeSuggestModal();
            } else {
                alert('VUI LÃ’NG NHáº¬P Äáº¦Y Äá»¦ GMAIL VÃ€ Gá»¢I Ã!');
            }
        }
    </script>
</body>
</html>
