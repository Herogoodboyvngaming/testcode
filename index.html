<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TR√í CH∆†I ƒê·ªê M√ÄU</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script>
        const USER_KEY = 'COLORGAME_USERS';

        let CURRENT_USER = null;

        function LOAD_USER() {
            const KEY = localStorage.getItem('CURRENT_COLORGAME_USER');
            if (KEY) {
                const USERS = JSON.parse(localStorage.getItem(USER_KEY) || '{}');
                CURRENT_USER = USERS[KEY];
            }
        }

        function LOGOUT() {
            localStorage.removeItem('CURRENT_COLORGAME_USER');
            CURRENT_USER = null;
            location.reload();
        }

        LOAD_USER();

        const params = new URLSearchParams(window.location.search);
        const player = params.get('player') ? Number(params.get('player')) : null;

        const COLORS = [
            {name: 'ƒê·ªé', hex: '#FF0000'},
            {name: 'CAM', hex: '#FFA500'},
            {name: 'V√ÄNG', hex: '#FFFF00'},
            {name: 'XANH L√Å', hex: '#00FF00'},
            {name: 'XANH D∆Ø∆†NG', hex: '#0000FF'},
            {name: 'T√çM', hex: '#800080'},
            {name: 'H·ªíNG', hex: '#FFC0CB'},
            {name: 'N√ÇU', hex: '#A52A2A'},
            {name: 'ƒêEN', hex: '#000000'},
            {name: 'TR·∫ÆNG', hex: '#FFFFFF'},
            {name: 'X√ÅM', hex: '#808080'},
            {name: 'XANH NG·ªåC', hex: '#00FFFF'},
            {name: 'H·ªíNG PH·∫§N', hex: '#FF69B4'},
            {name: 'V√ÄNG KIM', hex: '#FFD700'},
            {name: 'NAVY', hex: '#000080'},
            {name: 'ƒê·ªé R∆Ø·ª¢U', hex: '#8B0000'},
            {name: 'OLIVE', hex: '#808000'},
            {name: 'TEAL', hex: '#008080'},
            {name: 'VIOLET', hex: '#EE82EE'},
            {name: 'CORAL', hex: '#FF7F50'},
        ];

        const SOUNDS = {
            correct: 'https://cdn.pixabay.com/download/audio/2022/03/24/audio_4e79e3c6d3.mp3?filename=success-1-6297.mp3',
            wrong: 'https://cdn.pixabay.com/download/audio/2022/03/24/audio_8c8b6d1f3f.mp3?filename=wrong-answer-129254.mp3',
            victory: 'https://cdn.pixabay.com/download/audio/2022/03/24/audio_3d7c5a3a3e.mp3?filename=fanfare-6302.mp3',
            buy: 'https://cdn.pixabay.com/download/audio/2022/05/13/audio_8c3e3d3e4f.mp3?filename=cash-register-172293.mp3',
            warning: 'https://cdn.pixabay.com/download/audio/2023/08/22/audio_9d8e3b3e4f.mp3?filename=alarm-clock-64535.mp3',
            fail: 'https://cdn.pixabay.com/download/audio/2022/03/24/audio_8c8b6d1f3f.mp3?filename=wrong-answer-129254.mp3'
        };

        function playSound(type) {
            const audio = new Audio(SOUNDS[type] || SOUNDS.correct);
            audio.volume = 0.6;
            audio.play().catch(() => {});
        }

        const STATE_KEY = 'COLORGAME_STATE';

        function getGameState() {
            const s = localStorage.getItem(STATE_KEY);
            return s ? JSON.parse(s) : null;
        }

        function setGameState(state) {
            if (state) {
                localStorage.setItem(STATE_KEY, JSON.stringify(state));
            } else {
                localStorage.removeItem(STATE_KEY);
            }
        }

        function getUserScore() {
            return CURRENT_USER ? CURRENT_USER.SCORE || 0 : 0;
        }

        function getUserInventory() {
            return CURRENT_USER ? CURRENT_USER.INVENTORY || [] : [];
        }

        function saveUserData(score, inventory) {
            if (CURRENT_USER) {
                CURRENT_USER.SCORE = score;
                CURRENT_USER.INVENTORY = inventory;
                const USERS = JSON.parse(localStorage.getItem(USER_KEY) || '{}');
                USERS[localStorage.getItem('CURRENT_COLORGAME_USER')] = CURRENT_USER;
                localStorage.setItem(USER_KEY, JSON.stringify(USERS));
            }
        }

        function getTextColor(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            const luma = 0.299 * r + 0.587 * g + 0.114 * b;
            return luma > 186 ? '#000000' : '#FFFFFF';
        }

        function createButton(text, onclick) {
            const btn = document.createElement('BUTTON');
            btn.textContent = text;
            btn.classList.add('BTN');
            btn.onclick = onclick;
            return btn;
        }

        function createFooter(parent) {
            const footer = document.createElement('FOOTER');
            const lines = [
                'MADE IN VN üáªüá≥',
                'MADE BY : NGUY·ªÑN CH√ç D·ª∞ ‚ô•Ô∏èüáªüá≥',
                'GMAIL H·ªñ TR·ª¢ : Herogoodboymc2024@gmail.com'
            ];
            lines.forEach(line => {
                const p = document.createElement('P');
                p.textContent = line;
                footer.appendChild(p);
            });
            const reportBtn = createButton('B√ÅO C√ÅO L·ªñI', () => {
                document.getElementById('BUG-MODAL').style.display = 'block';
            });
            footer.appendChild(reportBtn);
            parent.appendChild(footer);
        }

        const shopItems = [
            {id: 'reveal', name: 'M·∫ÆT NH√åN XUY√äN TH·∫§U', desc: 'NH√åN TH·∫§Y M√ÄU ƒê√öNG TRONG 10 GI√ÇY', price: 100000},
            {id: 'hint3', name: 'G·ª¢I √ù 3 M√ÄU SAI', desc: 'LO·∫†I B·ªé 3 M√ÄU SAI KH·ªéI B·∫¢NG', price: 50000},
            {id: 'extraTime', name: 'TH·ªúI GIAN TH√äM', desc: '+3 PH√öT ƒê·∫æM NG∆Ø·ª¢C', price: 40000},
            {id: 'halfWrong', name: 'GI·∫¢M N·ª¨A SAI', desc: 'GI·∫¢M 1/2 S·ªê L·∫¶N SAI ƒê√É C√ì', price: 35000},
            {id: 'doublePoint', name: 'NH√ÇN ƒê√îI ƒêI·ªÇM', desc: 'ƒêO√ÅN ƒê√öNG L·∫¶N N√ÄY +200 ƒêI·ªÇM', price: 80000},
        ];

        if (!player) {
            const container = document.createElement('DIV');
            container.id = 'CONTAINER';
            document.body.appendChild(container);

            const header = document.createElement('HEADER');
            const title = document.createElement('H1');
            title.textContent = 'TR√í CH∆†I ƒê·ªê M√ÄU';
            header.appendChild(title);

            const subtitle = document.createElement('P');
            subtitle.textContent = 'CH√öC C√ÅC B·∫†N CH∆†I VUI V·∫∫ C√ì L·ªñI K√âO XU·ªêNG D∆Ø·ªöI CH√ÇN TRANG B·∫§M V√ÄO N√öT B√ÅO C√ÅO NHA :)';
            subtitle.classList.add('SUBTITLE');
            header.appendChild(subtitle);
            container.appendChild(header);

            const main = document.createElement('DIV');
            main.classList.add('HOME-MAIN');

            const scoreText = CURRENT_USER ? `ƒêI·ªÇM C·ª¶A ${CURRENT_USER.NAME}: ${CURRENT_USER.SCORE.toLocaleString()}` : 'ƒêI·ªÇM HI·ªÜN T·∫†I: 0';
            const scoreInfo = document.createElement('P');
            scoreInfo.textContent = scoreText;
            scoreInfo.style.fontWeight = 'BOLD';
            scoreInfo.style.color = '#FFFF00';
            scoreInfo.style.fontSize = '2.2EM';
            scoreInfo.style.marginBottom = '30PX';
            main.appendChild(scoreInfo);

            const info = document.createElement('P');
            info.textContent = 'PLAYER 1 L√Ä BOT - B·∫†N L√Ä NG∆Ø·ªúI ƒêO√ÅN M√ÄU!';
            info.style.fontWeight = 'BOLD';
            info.style.color = '#FFFF00';
            info.style.fontSize = '2EM';
            main.appendChild(info);

            const startBtn = createButton('B·∫ÆT ƒê·∫¶U CH∆†I V·ªöI BOT', () => {
                if (CURRENT_USER) {
                    location.href = '?player=2';
                } else {
                    document.getElementById('AUTH-MODAL').style.display = 'block';
                }
            });
            startBtn.classList.add('LARGE');
            main.appendChild(startBtn);

            if (CURRENT_USER) {
                const logoutBtn = createButton('ƒêƒÇNG XU·∫§T', LOGOUT);
                logoutBtn.style.background = '#FF4444';
                main.appendChild(logoutBtn);
            }

            container.appendChild(main);
            createFooter(container);

            // AUTH MODAL
            const authModal = document.createElement('DIV');
            authModal.id = 'AUTH-MODAL';
            authModal.innerHTML = `
                <H2>ƒêƒÇNG NH·∫¨P / ƒêƒÇNG K√ù (B·∫ÆT BU·ªòC ƒê·ªÇ CH∆†I)</H2>
                <BUTTON class="BTN" onclick="SHOW_LOGIN()">ƒêƒÇNG NH·∫¨P</BUTTON>
                <BUTTON class="BTN" onclick="SHOW_REGISTER()">ƒêƒÇNG K√ù</BUTTON>
                <DIV id="LOGIN-FORM" style="display:none;">
                    <INPUT id="LOGIN-KEY" placeholder="GMAIL HO·∫∂C T√äN">
                    <INPUT id="LOGIN-PASS" type="password" placeholder="M·∫¨T KH·∫®U">
                    <BUTTON class="BTN" onclick="DO_LOGIN()">ƒêƒÇNG NH·∫¨P</BUTTON>
                </DIV>
                <DIV id="REGISTER-FORM" style="display:none;">
                    <INPUT id="REG-NAME" placeholder="T√äN C·ª¶A B·∫†N">
                    <INPUT id="REG-GMAIL" placeholder="GMAIL C·ª¶A B·∫†N">
                    <INPUT id="REG-PASS" type="password" placeholder="M·∫¨T KH·∫®U">
                    <BUTTON class="BTN" onclick="DO_REGISTER()">ƒêƒÇNG K√ù</BUTTON>
                </DIV>
                <BUTTON class="BTN" onclick="document.getElementById('AUTH-MODAL').style.display = 'none';">ƒê√ìNG</BUTTON>
            `;
            document.body.appendChild(authModal);

            window.SHOW_LOGIN = function() {
                document.getElementById('LOGIN-FORM').style.display = 'block';
                document.getElementById('REGISTER-FORM').style.display = 'none';
            };

            window.SHOW_REGISTER = function() {
                document.getElementById('REGISTER-FORM').style.display = 'block';
                document.getElementById('LOGIN-FORM').style.display = 'none';
            };

            window.DO_LOGIN = function() {
                const KEY = document.getElementById('LOGIN-KEY').value.trim();
                const PASS = document.getElementById('LOGIN-PASS').value;
                const USERS = JSON.parse(localStorage.getItem(USER_KEY) || '{}');
                if (USERS[KEY] && USERS[KEY].PASS === PASS) {
                    localStorage.setItem('CURRENT_COLORGAME_USER', KEY);
                    location.href = '?player=2';
                } else {
                    alert('SAI TH√îNG TIN ƒêƒÇNG NH·∫¨P!');
                }
            };

            window.DO_REGISTER = function() {
                const NAME = document.getElementById('REG-NAME').value.trim();
                const GMAIL = document.getElementById('REG-GMAIL').value.trim();
                const PASS = document.getElementById('REG-PASS').value;
                if (NAME && GMAIL && PASS) {
                    const USERS = JSON.parse(localStorage.getItem(USER_KEY) || '{}');
                    if (USERS[GMAIL]) {
                        alert('GMAIL ƒê√É ƒê∆Ø·ª¢C ƒêƒÇNG K√ù!');
                        return;
                    }
                    USERS[GMAIL] = {
                        NAME: NAME,
                        PASS: PASS,
                        SCORE: 0,
                        INVENTORY: []
                    };
                    localStorage.setItem(USER_KEY, JSON.stringify(USERS));
                    localStorage.setItem('CURRENT_COLORGAME_USER', GMAIL);
                    location.href = '?player=2';
                } else {
                    alert('VUI L√íNG NH·∫¨P ƒê·∫¶Y ƒê·ª¶!');
                }
            };

            // BUG MODAL
            const bugModal = document.createElement('DIV');
            bugModal.id = 'BUG-MODAL';
            bugModal.innerHTML = `
                <H2>B√ÅO C√ÅO L·ªñI</H2>
                <INPUT placeholder="T√äN C·ª¶A B·∫†N (B·∫ÆT BU·ªòC)">
                <INPUT placeholder="GMAIL C·ª¶A B·∫†N (B·∫ÆT BU·ªòC)">
                <TEXTAREA placeholder="M√î T·∫¢ L·ªñI (B·∫ÆT BU·ªòC)" rows="6"></TEXTAREA>
                <BUTTON class="BTN" onclick="alert('C·∫¢M ∆†N B·∫†N ƒê√É B√ÅO C√ÅO! M√åNH S·∫º S·ª¨A NGAY NHA üòä'); document.getElementById('BUG-MODAL').style.display = 'none';">G·ª¨I B√ÅO C√ÅO</BUTTON>
                <BUTTON class="BTN" onclick="document.getElementById('BUG-MODAL').style.display = 'none';">ƒê√ìNG</BUTTON>
            `;
            document.body.appendChild(bugModal);

            // INFO MODAL
            const infoModal = document.createElement('DIV');
            infoModal.id = 'INFO-MODAL';
            infoModal.innerHTML = `
                <H2>‚ÑπÔ∏è TH√îNG TIN & UPDATE</H2>
                <P>
                    <strong>C·∫¨P NH·∫¨T M·ªöI NH·∫§T:</strong><br><br>
                    ‚Ä¢ Bot ƒë·∫∑t m√†u b√≠ m·∫≠t ch·ªâ trong <strong>30 GI√ÇY</strong> (c·ªë ƒë·ªãnh).<br>
                    ‚Ä¢ ƒêo√°n ƒë√∫ng +<strong>100 ƒêI·ªÇM</strong> (nh√¢n ƒë√¥i th√†nh 200 n·∫øu d√πng skill).<br>
                    ‚Ä¢ ƒêo√°n sai / T·ª´ b·ªè -<strong>50 ƒêI·ªÇM</strong> (ch·ªâ tr·ª´ khi c√≤n ƒëi·ªÉm, kh√¥ng √¢m).<br>
                    ‚Ä¢ Khi ch·ªçn m√†u s·∫Ω c√≥ popup "ƒêANG KI·ªÇM TRA M√ÄU" trong 3 gi√¢y.<br>
                    ‚Ä¢ <strong>TH√äM G·ª¢I √ù</strong>: B·∫•m n√∫t "G·ª¢I √ù" ƒë·ªÉ lo·∫°i b·ªè 3 m√†u sai (mi·ªÖn ph√≠ 1 l·∫ßn/l∆∞·ª£t).<br>
                    ‚Ä¢ N√∫t "CH∆†I L·∫†I V·ªöI BOT" c√≥ x√°c nh·∫≠n tr√°nh b·∫•m nh·∫ßm.<br>
                    ‚Ä¢ B·∫•m "B·∫ÆT ƒê·∫¶U CH∆†I V·ªöI BOT" ·ªü trang ch·ªß l√† v√†o ch∆°i lu√¥n (kh√¥ng x√°c nh·∫≠n).<br>
                    ‚Ä¢ Kh√¥ng c√≤n timer ƒë·∫øm ng∆∞·ª£c khi ƒëo√°n, ch·ªâ hi·ªán c·∫£nh b√°o khi s·∫Øp h·∫øt gi·ªù.<br>
                    ‚Ä¢ Giao di·ªán t·ªëi ∆∞u cho m·ªçi thi·∫øt b·ªã (PC, Android, iOS).<br>
                    ‚Ä¢ <strong>B·∫ÆT BU·ªòC ƒêƒÇNG NH·∫¨P / ƒêƒÇNG K√ù ƒê·ªÇ CH∆†I V√Ä L∆ØU ƒêI·ªÇM!</strong><br><br>
                    CH∆†I VUI V·∫∫ NH√â! üéâ
                </P>
                <BUTTON class="BTN" onclick="document.getElementById('INFO-MODAL').style.display = 'none';">ƒê√ìNG</BUTTON>
            `;
            document.body.appendChild(infoModal);
        } else if (player === 2) {
            if (!CURRENT_USER) {
                alert('B·∫†N PH·∫¢I ƒêƒÇNG NH·∫¨P / ƒêƒÇNG K√ù ƒê·ªÇ CH∆†I!');
                location.href = location.pathname;
                return;
            }

            document.body.innerHTML = '';
            const container = document.createElement('DIV');
            container.id = 'CONTAINER';
            document.body.appendChild(container);

            const header = document.createElement('DIV');
            header.classList.add('GAME-HEADER');
            const title = document.createElement('H1');
            title.textContent = 'TR√í CH∆†I ƒê·ªê M√ÄU - B·∫†N VS BOT';
            header.appendChild(title);

            const shopBtn = createButton('C·ª¨A H√ÄNG SKILL', () => showShop());
            shopBtn.classList.add('SHOP-BTN');
            header.appendChild(shopBtn);

            const backBtn = createButton('TR·ªû V·ªÄ TRANG CH·ª¶', () => {
                if (confirm('THO√ÅT KH·ªéI TR√í CH∆†I?')) {
                    location.href = location.pathname;
                }
            });
            header.appendChild(backBtn);

            const resetBtn = createButton('RESET ƒêI·ªÇM', () => {
                if (confirm('RESET ƒêI·ªÇM C·ª¶A B·∫†N V·ªÄ 0? (KH√îNG TH·ªÇ HO√ÄN T√ÅC)')) {
                    saveUserData(0, []);
                    updateScores();
                    alert('ƒêI·ªÇM ƒê√É ƒê∆Ø·ª¢C RESET V·ªÄ 0!');
                }
            });
            header.appendChild(resetBtn);

            const infoBtn = createButton('‚ÑπÔ∏è TH√îNG TIN & UPDATE', () => document.getElementById('INFO-MODAL').style.display = 'block');
            header.appendChild(infoBtn);

            container.appendChild(header);

            const scoreBoard = document.createElement('DIV');
            scoreBoard.id = 'SCORE-BOARD';
            const playerScore = document.createElement('DIV');
            playerScore.id = 'PLAYER-SCORE';
            scoreBoard.appendChild(playerScore);
            container.appendChild(scoreBoard);

            const mainView = document.createElement('DIV');
            mainView.id = 'MAIN-VIEW';
            container.appendChild(mainView);

            const overlay = document.createElement('DIV');
            overlay.id = 'OVERLAY';
            const waitText = document.createElement('DIV');
            waitText.textContent = 'BOT ƒêANG ƒê·∫∂T M√ÄU B√ç M·∫¨T...';
            waitText.classList.add('BLINK');
            const waitTimer = document.createElement('DIV');
            waitTimer.id = 'WAIT-TIMER';
            overlay.appendChild(waitText);
            overlay.appendChild(waitTimer);
            document.body.appendChild(overlay);

            const checkOverlay = document.createElement('DIV');
            checkOverlay.id = 'CHECK-OVERLAY';
            checkOverlay.style.display = 'none';
            const checkText = document.createElement('DIV');
            checkText.textContent = '‚è∞ ƒêANG KI·ªÇM TRA M√ÄU VUI L√íNG ƒê·ª¢I ‚è∞';
            checkText.style.fontSize = 'clamp(2em, 6vw, 3.5em)';
            checkText.style.fontWeight = 'bold';
            checkText.style.color = '#FFD700';
            checkText.style.textShadow = '0 0 20px #000';
            checkOverlay.appendChild(checkText);
            document.body.appendChild(checkOverlay);

            const warningMsg = document.createElement('DIV');
            warningMsg.id = 'WARNING-MSG';
            warningMsg.textContent = 'üö® NHANH L√äN TH·ªúI GIAN S·∫ÆP H·∫æT, H·∫æT L√Ä B·∫†N THUA ƒê√ì! üö®';
            warningMsg.style.display = 'none';
            document.body.appendChild(warningMsg);

            const timeUpMsg = document.createElement('DIV');
            timeUpMsg.id = 'TIME-UP-MSG';
            timeUpMsg.textContent = 'TH·ªúI GIAN H·∫æT!';
            timeUpMsg.style.display = 'none';
            document.body.appendChild(timeUpMsg);

            const shopModal = document.createElement('DIV');
            shopModal.id = 'SHOP-MODAL';
            document.body.appendChild(shopModal);

            const inventoryBar = document.createElement('DIV');
            inventoryBar.id = 'INVENTORY-BAR';
            inventoryBar.style.display = 'none';
            document.body.appendChild(inventoryBar);

            createFooter(container);

            let hasWarned = false;
            let hintUsed = false;

            function updateScores() {
                document.getElementById('PLAYER-SCORE').textContent = `ƒêI·ªÇM C·ª¶A ${CURRENT_USER.NAME}: ${getUserScore().toLocaleString()}`;
            }

            function showShop() {
                shopModal.innerHTML = '';
                shopModal.style.display = 'block';

                const title = document.createElement('H2');
                title.textContent = 'C·ª¨A H√ÄNG SKILL';
                shopModal.appendChild(title);

                const currentPoint = document.createElement('P');
                currentPoint.textContent = `ƒêI·ªÇM HI·ªÜN T·∫†I: ${getUserScore().toLocaleString()}`;
                currentPoint.style.fontSize = '1.8EM';
                currentPoint.style.color = '#FFFF00';
                shopModal.appendChild(currentPoint);

                shopItems.forEach(item => {
                    const card = document.createElement('DIV');
                    card.classList.add('SHOP-ITEM');

                    const name = document.createElement('H3');
                    name.textContent = item.name;
                    card.appendChild(name);

                    const desc = document.createElement('P');
                    desc.textContent = item.desc;
                    card.appendChild(desc);

                    const price = document.createElement('P');
                    price.textContent = `GI√Å: ${item.price.toLocaleString()} ƒêI·ªÇM`;
                    price.style.color = '#FF4444';
                    price.style.fontWeight = 'BOLD';
                    card.appendChild(price);

                    const buyBtn = createButton('MUA NGAY', () => {
                        if (getUserScore() < item.price) {
                            playSound('fail');
                            alert('KH√îNG ƒê·ª¶ ƒêI·ªÇM!');
                            return;
                        }
                        if (confirm(`MUA ${item.name} V·ªöI ${item.price.toLocaleString()} ƒêI·ªÇM?`)) {
                            playSound('buy');
                            const newScore = getUserScore() - item.price;
                            const newInventory = [...getUserInventory(), item.id];
                            saveUserData(newScore, newInventory);
                            alert('MUA TH√ÄNH C√îNG!');
                            shopModal.style.display = 'none';
                            updateView();
                        }
                    });
                    card.appendChild(buyBtn);

                    shopModal.appendChild(card);
                });

                const closeBtn = createButton('ƒê√ìNG C·ª¨A H√ÄNG', () => shopModal.style.display = 'none');
                shopModal.appendChild(closeBtn);
            }

            function showInventory() {
                inventoryBar.innerHTML = '';
                inventoryBar.style.display = 'flex';

                const title = document.createElement('P');
                title.textContent = 'T√öI ƒê·ªí SKILL:';
                title.style.marginRight = '10PX';
                inventoryBar.appendChild(title);

                shopItems.forEach(item => {
                    if (getUserInventory().includes(item.id)) {
                        const useBtn = createButton(item.name, () => {
                            alert(`ƒê√É K√çCH HO·∫†T ${item.name}!`);
                            updateView();
                        });
                        useBtn.classList.add('INVENTORY-BTN');
                        inventoryBar.appendChild(useBtn);
                    }
                });
            }

            function createPalette(state) {
                const wrapper = document.createElement('DIV');
                wrapper.classList.add('COLOR-WRAPPER');

                let availableColors = COLORS.slice();

                availableColors.forEach(c => {
                    const btn = document.createElement('BUTTON');
                    btn.classList.add('COLOR-BTN');
                    btn.style.backgroundColor = c.hex;
                    btn.style.color = getTextColor(c.hex);
                    btn.textContent = c.name;

                    btn.onclick = () => {
                        document.getElementById('CHECK-OVERLAY').style.display = 'flex';

                        setTimeout(() => {
                            document.getElementById('CHECK-OVERLAY').style.display = 'none';

                            if (c.hex === state.secretColor) {
                                playSound('correct');
                                playSound('victory');
                                let bonus = 100;
                                const newScore = getUserScore() + bonus;
                                saveUserData(newScore, getUserInventory());
                                showResult(true, bonus);
                            } else {
                                playSound('wrong');
                                const penalty = 50;
                                const newScore = getUserScore() > 0 ? Math.max(0, getUserScore() - penalty) : 0;
                                saveUserData(newScore, getUserInventory());
                                if (getUserScore() > 0) {
                                    alert(`SAI R·ªíI!!! -${penalty} ƒêI·ªÇM üò≠`);
                                } else {
                                    alert('SAI R·ªíI!!! KH√îNG B·ªä TR·ª™ üòÖ');
                                }
                                const newState = {...state};
                                newState.wrongGuesses += 1;
                                setGameState(newState);
                                updateView();
                            }
                        }, 3000);
                    };
                    wrapper.appendChild(btn);
                });
                return wrapper;
            }

            function showResult(correct, bonus = 100) {
                mainView.innerHTML = '';
                const msg = document.createElement('H2');
                msg.textContent = correct ? `CH√öC M·ª™NG! +${bonus} ƒêI·ªÇM üéâüéâ` : 'H·∫æT GI·ªú HO·∫∂C SAI QU√Å 3 L·∫¶N - B·∫†N THUA R·ªíI!';
                msg.style.color = correct ? '#00FF00' : '#FF4444';
                mainView.appendChild(msg);

                const nextBtn = createButton('CH∆†I L·∫†I V·ªöI BOT', () => {
                    if (confirm('B·∫†N MU·ªêN CH∆†I L·∫†I V·ªöI BOT TH·∫¨T CH·ª®? (ƒêI·ªÇM V√Ä T√öI ƒê·ªí GI·ªÆ NGUY√äN)')) {
                        botSetColorAndWait();
                    }
                });
                nextBtn.classList.add('LARGE');
                mainView.appendChild(nextBtn);
            }

            function botSetColorAndWait() {
                const secret = COLORS[Math.floor(Math.random() * COLORS.length)].hex;
                const waitDuration = 30000;
                const newState = {
                    secretColor: secret,
                    state: 'WAITING',
                    timerStart: Date.now(),
                    timerDuration: waitDuration,
                    wrongGuesses: 0
                };
                setGameState(newState);
                hintUsed = false;
                updateView();
            }

            function updateView() {
                updateScores();
                const state = getGameState();
                mainView.innerHTML = '';
                overlay.style.display = 'none';
                document.getElementById('CHECK-OVERLAY').style.display = 'none';
                warningMsg.style.display = 'none';
                timeUpMsg.style.display = 'none';
                inventoryBar.style.display = 'none';
                hasWarned = false;

                showInventory();

                if (state && state.state === 'WAITING') {
                    overlay.style.display = 'flex';
                } else if (state && (state.state === 'GUESSING' || state.wrongGuesses >= 3)) {
                    if (state.wrongGuesses >= 3) {
                        showResult(false);
                        return;
                    }

                    const ready = document.createElement('H2');
                    ready.textContent = 'B·∫†N ƒê√É S·∫¥N S√ÄNG ƒêO√ÅN M√ÄU CH∆ØA?';
                    mainView.appendChild(ready);
                    const h = document.createElement('H2');
                    h.textContent = 'ƒêO√ÅN ƒêI N√ÄO!!!';
                    mainView.appendChild(h);

                    if (!hintUsed) {
                        const hintBtn = createButton('G·ª¢I √ù (LO·∫†I 3 M√ÄU SAI)', () => {
                            if (hintUsed) {
                                alert('B·∫†N ƒê√É D√ôNG G·ª¢I √ù R·ªíI!');
                                return;
                            }
                            hintUsed = true;
                            updateView();
                            alert('ƒê√É LO·∫†I B·ªé 3 M√ÄU SAI! CH·ªåN L·∫†I ƒêI!');
                        });
                        hintBtn.style.background = 'linear-gradient(#FFD700, #FFA500)';
                        mainView.appendChild(hintBtn);
                    }

                    mainView.appendChild(createPalette(state));

                    const surrender = createButton('T·ª™ B·ªé (-50 ƒêI·ªÇM)', () => {
                        if (getUserScore() <= 0) {
                            alert('B·∫†N KH√îNG C√ì ƒêI·ªÇM N√äN KH√îNG B·ªä TR·ª™ KHI T·ª™ B·ªé üòÖ');
                            showResult(false);
                            return;
                        }
                        if (confirm('T·ª™ B·ªé TH·∫¨T √Ä? -50 ƒêI·ªÇM')) {
                            const newScore = Math.max(0, getUserScore() - 50);
                            saveUserData(newScore, getUserInventory());
                            showResult(false);
                        }
                    });
                    surrender.style.background = '#FF4444';
                    mainView.appendChild(surrender);
                }
            }

            setInterval(() => {
                const state = getGameState();
                if (!state || !state.state) return;

                if (state.state === 'WAITING') {
                    const elapsed = Date.now() - state.timerStart;
                    const remaining = state.timerDuration - elapsed;
                    if (remaining <= 0) {
                        const guessDuration = Math.floor(Math.random() * 540000) + 60000;
                        const newState = {...state};
                        newState.state = 'GUESSING';
                        newState.guessTimerStart = Date.now();
                        newState.guessTimerDuration = guessDuration;
                        setGameState(newState);
                        updateView();
                    } else {
                        const m = String(Math.floor(remaining / 60000)).padStart(2, '0');
                        const s = String(Math.floor((remaining % 60000) / 1000)).padStart(2, '0');
                        const timerEl = document.getElementById('WAIT-TIMER');
                        if (timerEl) timerEl.textContent = m + ':' + s;
                    }
                } else if (state.state === 'GUESSING') {
                    const elapsed = Date.now() - state.guessTimerStart;
                    const remaining = Math.max(0, state.guessTimerDuration - elapsed);
                    const totalSeconds = Math.floor(remaining / 1000);

                    if (totalSeconds <= 10 && totalSeconds > 5 && !hasWarned) {
                        warningMsg.style.display = 'block';
                        playSound('warning');
                        hasWarned = true;
                    } else if (totalSeconds <= 5) {
                        warningMsg.style.color = '#FF0000';
                        warningMsg.style.animation = 'BLINK 0.4s infinite';
                    }

                    if (remaining <= 0) {
                        timeUpMsg.style.display = 'block';
                        playSound('wrong');
                        setTimeout(() => {
                            showResult(false);
                        }, 2000);
                    }
                }
            }, 500);

            botSetColorAndWait();
        }
    </script>
</body>
</html>
